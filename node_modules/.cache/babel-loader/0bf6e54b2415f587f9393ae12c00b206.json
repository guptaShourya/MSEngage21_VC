{"ast":null,"code":"import _regeneratorRuntime from \"/Users/shouryagupta/Desktop/MS Engage 21/MSEngage21_VC/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/shouryagupta/Desktop/MS Engage 21/MSEngage21_VC/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\n// const handleMessageAdded = (message, setMessages, messages) => {\n//     // const { messages } = this.state;\n//     // this.setState(\n//     //   {\n//     //     messages: !!messages ? [...messages, message] : [message],\n//     //   },\n//     // );\n//     setMessages((!!messages?[...messages, message] : [message]));\n//   };\nvar joinChannel = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(channel, handleMessageAdded) {\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (!(channel.channelState.status !== \"joined\")) {\n              _context.next = 3;\n              break;\n            }\n\n            _context.next = 3;\n            return channel.join();\n\n          case 3:\n            channel.on(\"messageAdded\", handleMessageAdded);\n\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function joinChannel(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar joinChat = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(room, client, setChannel, setMessages, setChannelList, setLoading, handleMessageAdded) {\n    var channel, allMessages, channels, _channel, _channels;\n\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            //   const {client} = this.state;\n            console.log(room);\n            _context2.next = 4;\n            return client.getChannelByUniqueName(room);\n\n          case 4:\n            channel = _context2.sent;\n            _context2.next = 7;\n            return joinChannel(channel);\n\n          case 7:\n            setChannel(channel);\n            setLoading(false); //   this.setState({ channel, loading: false });\n\n            _context2.next = 11;\n            return channel.getMessages();\n\n          case 11:\n            allMessages = _context2.sent;\n            setMessages(allMessages.items || []); //   this.setState({ messages: messages.items || [] });\n\n            _context2.next = 15;\n            return client.getSubscribedChannels();\n\n          case 15:\n            channels = _context2.sent;\n            setChannelList(channels.items || []); //   this.setState({channelList: channels.items || []});\n\n            _context2.next = 38;\n            break;\n\n          case 19:\n            _context2.prev = 19;\n            _context2.t0 = _context2[\"catch\"](0);\n            _context2.prev = 21;\n            _context2.next = 24;\n            return client.createChannel({\n              uniqueName: room,\n              friendlyName: room\n            });\n\n          case 24:\n            _channel = _context2.sent;\n            _context2.next = 27;\n            return joinChannel(_channel);\n\n          case 27:\n            setLoading(false);\n            setChannel(_channel); // this.setState({ channel, loading: false });\n\n            _context2.next = 31;\n            return client.getSubscribedChannels();\n\n          case 31:\n            _channels = _context2.sent;\n            setChannelList(_channels.items || []); // this.setState({channelList: channels.items || []});\n\n            _context2.next = 38;\n            break;\n\n          case 35:\n            _context2.prev = 35;\n            _context2.t1 = _context2[\"catch\"](21);\n            throw new Error(\"unable to create channel, please reload this page\");\n\n          case 38:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, null, [[0, 19], [21, 35]]);\n  }));\n\n  return function joinChat(_x3, _x4, _x5, _x6, _x7, _x8, _x9) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexport default joinChat;","map":{"version":3,"sources":["/Users/shouryagupta/Desktop/MS Engage 21/MSEngage21_VC/src/joinChatRoom.js"],"names":["joinChannel","channel","handleMessageAdded","channelState","status","join","on","joinChat","room","client","setChannel","setMessages","setChannelList","setLoading","console","log","getChannelByUniqueName","getMessages","allMessages","items","getSubscribedChannels","channels","createChannel","uniqueName","friendlyName","Error"],"mappings":";;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,IAAMA,WAAW;AAAA,sEAAG,iBAAOC,OAAP,EAAgBC,kBAAhB;AAAA;AAAA;AAAA;AAAA;AAAA,kBACZD,OAAO,CAACE,YAAR,CAAqBC,MAArB,KAAgC,QADpB;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAERH,OAAO,CAACI,IAAR,EAFQ;;AAAA;AAIhBJ,YAAAA,OAAO,CAACK,EAAR,CAAW,cAAX,EAA2BJ,kBAA3B;;AAJgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAXF,WAAW;AAAA;AAAA;AAAA,GAAjB;;AAOA,IAAMO,QAAQ;AAAA,uEAAG,kBAAOC,IAAP,EAAaC,MAAb,EAAqBC,UAArB,EAAiCC,WAAjC,EAA8CC,cAA9C,EAA8DC,UAA9D,EAA0EX,kBAA1E;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEb;AACEY,YAAAA,OAAO,CAACC,GAAR,CAAYP,IAAZ;AAHW;AAAA,mBAIWC,MAAM,CAACO,sBAAP,CAA8BR,IAA9B,CAJX;;AAAA;AAILP,YAAAA,OAJK;AAAA;AAAA,mBAKLD,WAAW,CAACC,OAAD,CALN;;AAAA;AAMXS,YAAAA,UAAU,CAACT,OAAD,CAAV;AACAY,YAAAA,UAAU,CAAC,KAAD,CAAV,CAPW,CAQb;;AARa;AAAA,mBASeZ,OAAO,CAACgB,WAAR,EATf;;AAAA;AASLC,YAAAA,WATK;AAUXP,YAAAA,WAAW,CAAEO,WAAW,CAACC,KAAZ,IAAmB,EAArB,CAAX,CAVW,CAWb;;AAXa;AAAA,mBAYYV,MAAM,CAACW,qBAAP,EAZZ;;AAAA;AAYLC,YAAAA,QAZK;AAaXT,YAAAA,cAAc,CAAES,QAAQ,CAACF,KAAT,IAAkB,EAApB,CAAd,CAbW,CAcb;;AAda;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAkBaV,MAAM,CAACa,aAAP,CAAqB;AACzCC,cAAAA,UAAU,EAAEf,IAD6B;AAEzCgB,cAAAA,YAAY,EAAEhB;AAF2B,aAArB,CAlBb;;AAAA;AAkBHP,YAAAA,QAlBG;AAAA;AAAA,mBAsBHD,WAAW,CAACC,QAAD,CAtBR;;AAAA;AAuBTY,YAAAA,UAAU,CAAC,KAAD,CAAV;AACAH,YAAAA,UAAU,CAACT,QAAD,CAAV,CAxBS,CAyBT;;AAzBS;AAAA,mBA0BcQ,MAAM,CAACW,qBAAP,EA1Bd;;AAAA;AA0BHC,YAAAA,SA1BG;AA2BTT,YAAAA,cAAc,CAAES,SAAQ,CAACF,KAAT,IAAkB,EAApB,CAAd,CA3BS,CA4BT;;AA5BS;AAAA;;AAAA;AAAA;AAAA;AAAA,kBA8BH,IAAIM,KAAJ,CAAU,mDAAV,CA9BG;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAARlB,QAAQ;AAAA;AAAA;AAAA,GAAd;;AAmCE,eAAeA,QAAf","sourcesContent":["// const handleMessageAdded = (message, setMessages, messages) => {\n//     // const { messages } = this.state;\n//     // this.setState(\n//     //   {\n//     //     messages: !!messages ? [...messages, message] : [message],\n//     //   },\n//     // );\n//     setMessages((!!messages?[...messages, message] : [message]));\n//   };\n\nconst joinChannel = async (channel, handleMessageAdded) => {\n    if (channel.channelState.status !== \"joined\") {\n      await channel.join();\n    }\n    channel.on(\"messageAdded\", handleMessageAdded);\n  };\n\nconst joinChat = async (room, client, setChannel, setMessages, setChannelList, setLoading, handleMessageAdded)=>{\n    try {\n    //   const {client} = this.state;\n      console.log(room);\n      const channel = await client.getChannelByUniqueName(room);\n      await joinChannel(channel);\n      setChannel(channel);\n      setLoading(false);\n    //   this.setState({ channel, loading: false });\n      const allMessages = await channel.getMessages();\n      setMessages((allMessages.items||[]));\n    //   this.setState({ messages: messages.items || [] });\n      const channels = await client.getSubscribedChannels();\n      setChannelList((channels.items || []));\n    //   this.setState({channelList: channels.items || []});\n    } catch {\n      try {\n        // const {client} = this.state;\n        const channel = await client.createChannel({\n          uniqueName: room,\n          friendlyName: room,\n        });\n        await joinChannel(channel);\n        setLoading(false);\n        setChannel(channel);\n        // this.setState({ channel, loading: false });\n        const channels = await client.getSubscribedChannels();\n        setChannelList((channels.items || []));\n        // this.setState({channelList: channels.items || []});\n      } catch {\n        throw new Error(\"unable to create channel, please reload this page\");\n      }\n    }\n  };\n\n  export default joinChat;"]},"metadata":{},"sourceType":"module"}