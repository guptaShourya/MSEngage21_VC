{"ast":null,"code":"'use strict';\n\nvar _ = require('lodash');\n\nvar axios = require('axios');\n\nvar fs = require('fs');\n\nvar http = require('http');\n\nvar https = require('https');\n\nvar Q = require('q');\n\nvar qs = require('qs');\n\nvar Response = require('../http/response');\n\nvar Request = require('../http/request');\n\naxios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';\n\nvar RequestClient = function RequestClient() {};\n/**\n * Make http request\n * @param {object} opts - The options argument\n * @param {string} opts.method - The http method\n * @param {string} opts.uri - The request uri\n * @param {string} [opts.username] - The username used for auth\n * @param {string} [opts.password] - The password used for auth\n * @param {object} [opts.headers] - The request headers\n * @param {object} [opts.params] - The request params\n * @param {object} [opts.data] - The request data\n * @param {int} [opts.timeout=30000] - The request timeout in milliseconds\n * @param {boolean} [opts.allowRedirects] - Should the client follow redirects\n * @param {boolean} [opts.forever] - Set to true to use the forever-agent\n * @param {string} [opts.logLevel] - Show debug logs\n */\n\n\nRequestClient.prototype.request = function (opts) {\n  opts = opts || {};\n\n  if (!opts.method) {\n    throw new Error('http method is required');\n  }\n\n  if (!opts.uri) {\n    throw new Error('uri is required');\n  }\n\n  var deferred = Q.defer();\n  var headers = opts.headers || {};\n\n  if (!headers.Connection && !headers.connection) {\n    headers.Connection = 'close';\n  }\n\n  if (opts.username && opts.password) {\n    var b64Auth = Buffer.from(opts.username + ':' + opts.password).toString('base64');\n    headers.Authorization = 'Basic ' + b64Auth;\n  }\n\n  var options = {\n    timeout: opts.timeout || 30000,\n    maxRedirects: opts.allowRedirects ? 10 : 0,\n    // Same number of allowed redirects as request module default\n    url: opts.uri,\n    method: opts.method,\n    headers: opts.headers,\n    httpAgent: opts.forever ? new http.Agent({\n      keepAlive: true\n    }) : undefined,\n    httpsAgent: opts.forever ? new https.Agent({\n      keepAlive: true\n    }) : undefined,\n    validateStatus: status => status >= 100 && status < 600\n  };\n\n  if (process.env.TWILIO_CA_BUNDLE !== undefined) {\n    if (this.ca === undefined) {\n      this.ca = fs.readFileSync(process.env.TWILIO_CA_BUNDLE);\n    }\n\n    options.ca = this.ca;\n  }\n\n  if (!_.isNull(opts.data)) {\n    options.data = qs.stringify(opts.data, {\n      arrayFormat: 'repeat'\n    });\n  }\n\n  if (!_.isNull(opts.params)) {\n    options.params = opts.params;\n\n    options.paramsSerializer = params => {\n      return qs.stringify(params, {\n        arrayFormat: 'repeat'\n      });\n    };\n  }\n\n  var optionsRequest = {\n    method: options.method,\n    url: options.url,\n    auth: b64Auth || null,\n    params: options.params,\n    data: opts.data,\n    headers: options.headers,\n    ca: options.ca\n  };\n\n  if (opts.logLevel === 'debug') {\n    this.logRequest(options);\n  }\n\n  var _this = this;\n\n  this.lastResponse = undefined;\n  this.lastRequest = new Request(optionsRequest);\n  axios(options).then(response => {\n    if (opts.logLevel === 'debug') {\n      console.log(\"response.statusCode: \".concat(response.status));\n      console.log(\"response.headers: \".concat(JSON.stringify(response.headers)));\n    }\n\n    _this.lastResponse = new Response(response.status, response.data, response.headers);\n    deferred.resolve({\n      statusCode: response.status,\n      body: response.data\n    });\n  }).catch(error => {\n    _this.lastResponse = undefined;\n    deferred.reject(error);\n  });\n  return deferred.promise;\n};\n\nRequestClient.prototype.filterLoggingHeaders = function (headers) {\n  return Object.keys(headers).filter(header => {\n    return !'authorization'.includes(header.toLowerCase());\n  });\n};\n\nRequestClient.prototype.logRequest = function (options) {\n  console.log('-- BEGIN Twilio API Request --');\n  console.log(\"\".concat(options.method, \" \").concat(options.url));\n\n  if (options.params) {\n    console.log('Querystring:');\n    console.log(options.params);\n  }\n\n  if (options.headers) {\n    console.log('Headers:');\n    const filteredHeaderKeys = this.filterLoggingHeaders(options.headers);\n    filteredHeaderKeys.forEach(header => console.log(\"\".concat(header, \": \").concat(options.headers[header])));\n  }\n\n  console.log('-- END Twilio API Request --');\n};\n\nmodule.exports = RequestClient;","map":{"version":3,"sources":["/Users/shouryagupta/Desktop/MS Engage 21/MSEngage21_VC/node_modules/twilio/lib/base/RequestClient.js"],"names":["_","require","axios","fs","http","https","Q","qs","Response","Request","defaults","headers","post","RequestClient","prototype","request","opts","method","Error","uri","deferred","defer","Connection","connection","username","password","b64Auth","Buffer","from","toString","Authorization","options","timeout","maxRedirects","allowRedirects","url","httpAgent","forever","Agent","keepAlive","undefined","httpsAgent","validateStatus","status","process","env","TWILIO_CA_BUNDLE","ca","readFileSync","isNull","data","stringify","arrayFormat","params","paramsSerializer","optionsRequest","auth","logLevel","logRequest","_this","lastResponse","lastRequest","then","response","console","log","JSON","resolve","statusCode","body","catch","error","reject","promise","filterLoggingHeaders","Object","keys","filter","header","includes","toLowerCase","filteredHeaderKeys","forEach","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar _ = require('lodash');\nvar axios = require('axios');\nvar fs = require('fs');\nvar http = require('http');\nvar https = require('https');\nvar Q = require('q');\nvar qs = require('qs');\nvar Response = require('../http/response');\nvar Request = require('../http/request');\n\naxios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';\n\nvar RequestClient = function() {};\n\n/**\n * Make http request\n * @param {object} opts - The options argument\n * @param {string} opts.method - The http method\n * @param {string} opts.uri - The request uri\n * @param {string} [opts.username] - The username used for auth\n * @param {string} [opts.password] - The password used for auth\n * @param {object} [opts.headers] - The request headers\n * @param {object} [opts.params] - The request params\n * @param {object} [opts.data] - The request data\n * @param {int} [opts.timeout=30000] - The request timeout in milliseconds\n * @param {boolean} [opts.allowRedirects] - Should the client follow redirects\n * @param {boolean} [opts.forever] - Set to true to use the forever-agent\n * @param {string} [opts.logLevel] - Show debug logs\n */\nRequestClient.prototype.request = function(opts) {\n  opts = opts || {};\n  if (!opts.method) {\n    throw new Error('http method is required');\n  }\n\n  if (!opts.uri) {\n    throw new Error('uri is required');\n  }\n\n  var deferred = Q.defer();\n  var headers = opts.headers || {};\n\n  if (!headers.Connection && !headers.connection) {\n    headers.Connection = 'close';\n  }\n\n  if (opts.username && opts.password) {\n    var b64Auth = Buffer.from(opts.username + ':' + opts.password).toString('base64');\n    headers.Authorization = 'Basic ' + b64Auth;\n  }\n\n  var options = {\n    timeout: opts.timeout || 30000,\n    maxRedirects: opts.allowRedirects ? 10 : 0, // Same number of allowed redirects as request module default\n    url: opts.uri,\n    method: opts.method,\n    headers: opts.headers,\n    httpAgent: opts.forever ? new http.Agent({ keepAlive: true }) : undefined,\n    httpsAgent: opts.forever ? new https.Agent({ keepAlive: true }) : undefined,\n    validateStatus: status => status >= 100 && status < 600,\n  };\n\n  if (process.env.TWILIO_CA_BUNDLE !== undefined) {\n    if (this.ca === undefined) {\n      this.ca = fs.readFileSync(process.env.TWILIO_CA_BUNDLE);\n    }\n    options.ca = this.ca;\n  }\n\n  if (!_.isNull(opts.data)) {\n    options.data = qs.stringify(opts.data, { arrayFormat: 'repeat'});\n  }\n\n  if (!_.isNull(opts.params)) {\n    options.params = opts.params;\n    options.paramsSerializer = (params) => {\n      return qs.stringify(params, { arrayFormat: 'repeat' });\n    };\n  }\n\n  var optionsRequest = {\n    method: options.method,\n    url: options.url,\n    auth: b64Auth || null,\n    params: options.params,\n    data: opts.data,\n    headers: options.headers,\n    ca: options.ca\n  };\n\n  if (opts.logLevel === 'debug') {\n    this.logRequest(options)\n  }\n\n  var _this = this;\n  this.lastResponse = undefined;\n  this.lastRequest = new Request(optionsRequest);\n\n  axios(options).then((response) => {\n    if (opts.logLevel === 'debug') {\n      console.log(`response.statusCode: ${response.status}`)\n      console.log(`response.headers: ${JSON.stringify(response.headers)}`)\n    }\n    _this.lastResponse = new Response(response.status, response.data, response.headers);\n    deferred.resolve({\n      statusCode: response.status,\n      body: response.data,\n    });\n  }).catch((error) => {\n    _this.lastResponse = undefined;\n    deferred.reject(error);\n  });\n\n  return deferred.promise;\n};\n\nRequestClient.prototype.filterLoggingHeaders = function (headers){\n  return Object.keys(headers).filter((header) => {\n    return !'authorization'.includes(header.toLowerCase());\n  });\n}\n\nRequestClient.prototype.logRequest = function (options){\n  console.log('-- BEGIN Twilio API Request --');\n  console.log(`${options.method} ${options.url}`);\n\n  if (options.params) {\n    console.log('Querystring:');\n    console.log(options.params);\n  }\n\n  if (options.headers) {\n    console.log('Headers:');\n    const filteredHeaderKeys = this.filterLoggingHeaders(options.headers);\n    filteredHeaderKeys.forEach((header) => console.log(`${header}: ${options.headers[header]}`));\n  }\n\n  console.log('-- END Twilio API Request --');\n}\n\nmodule.exports = RequestClient;\n"]},"metadata":{},"sourceType":"script"}