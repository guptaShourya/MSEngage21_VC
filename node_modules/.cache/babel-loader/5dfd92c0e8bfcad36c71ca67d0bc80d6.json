{"ast":null,"code":"'use strict';\n\nvar _slicedToArray = function () {\n  function sliceIterator(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"]) _i[\"return\"]();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  return function (arr, i) {\n    if (Array.isArray(arr)) {\n      return arr;\n    } else if (Symbol.iterator in Object(arr)) {\n      return sliceIterator(arr, i);\n    } else {\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n    }\n  };\n}();\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _get = function get(object, property, receiver) {\n  if (object === null) object = Function.prototype;\n  var desc = Object.getOwnPropertyDescriptor(object, property);\n\n  if (desc === undefined) {\n    var parent = Object.getPrototypeOf(object);\n\n    if (parent === null) {\n      return undefined;\n    } else {\n      return get(parent, property, receiver);\n    }\n  } else if (\"value\" in desc) {\n    return desc.value;\n  } else {\n    var getter = desc.get;\n\n    if (getter === undefined) {\n      return undefined;\n    }\n\n    return getter.call(receiver);\n  }\n};\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nvar mixinRemoteMediaTrack = require('./remotemediatrack');\n\nvar VideoTrack = require('./videotrack');\n\nvar documentVisibilityMonitor = require('../../util/documentvisibilitymonitor.js');\n\nvar _require = require('../../util/nullobserver.js'),\n    NullObserver = _require.NullObserver;\n\nvar RemoteMediaVideoTrack = mixinRemoteMediaTrack(VideoTrack);\n/**\n * A {@link RemoteVideoTrack} represents a {@link VideoTrack} published to a\n * {@link Room} by a {@link RemoteParticipant}.\n * @extends VideoTrack\n * @property {boolean} isEnabled - Whether the {@link RemoteVideoTrack} is enabled\n * @property {boolean} isSwitchedOff - Whether the {@link RemoteVideoTrack} is switched off\n * @property {Track.SID} sid - The {@link RemoteVideoTrack}'s SID\n * @property {?Track.Priority} priority - The subscribe priority of the {@link RemoteVideoTrack}\n * @emits RemoteVideoTrack#dimensionsChanged\n * @emits RemoteVideoTrack#disabled\n * @emits RemoteVideoTrack#enabled\n * @emits RemoteVideoTrack#started\n * @emits RemoteVideoTrack#switchedOff\n * @emits RemoteVideoTrack#switchedOn\n */\n\nvar RemoteVideoTrack = function (_RemoteMediaVideoTrac) {\n  _inherits(RemoteVideoTrack, _RemoteMediaVideoTrac);\n  /**\n   * Construct a {@link RemoteVideoTrack}.\n   * @param {Track.SID} sid - The {@link RemoteVideoTrack}'s SID\n   * @param {MediaTrackReceiver} mediaTrackReceiver - A video MediaStreamTrack container\n   * @param {boolean} isEnabled - whether the {@link RemoteVideoTrack} is enabled\n   * @param {boolean} isSwitchedOff - Whether the {@link RemoteVideoTrack} is switched off\n   * @param {function(?Track.Priority): void} setPriority - Set or clear the subscribe\n   *  {@link Track.Priority} of the {@link RemoteVideoTrack}\n   * @param {function(ClientRenderHint): void} setRenderHint - Set render hints.\n   * @param {{log: Log}} options - The {@link RemoteTrack} options\n   */\n\n\n  function RemoteVideoTrack(sid, mediaTrackReceiver, isEnabled, isSwitchedOff, setPriority, setRenderHint, options) {\n    _classCallCheck(this, RemoteVideoTrack);\n\n    options = Object.assign({\n      clientTrackSwitchOffControl: 'auto',\n      contentPreferencesMode: 'auto',\n      enableDocumentVisibilityTurnOff: true\n    }, options);\n    options = Object.assign({\n      IntersectionObserver: typeof IntersectionObserver === 'undefined' || options.clientTrackSwitchOffControl !== 'auto' ? NullObserver : IntersectionObserver,\n      ResizeObserver: typeof ResizeObserver === 'undefined' || options.contentPreferencesMode !== 'auto' ? NullObserver : ResizeObserver\n    }, options);\n\n    var _this = _possibleConstructorReturn(this, (RemoteVideoTrack.__proto__ || Object.getPrototypeOf(RemoteVideoTrack)).call(this, sid, mediaTrackReceiver, isEnabled, isSwitchedOff, setPriority, setRenderHint, options));\n\n    Object.defineProperties(_this, {\n      _enableDocumentVisibilityTurnOff: {\n        value: options.enableDocumentVisibilityTurnOff === true && options.clientTrackSwitchOffControl === 'auto'\n      },\n      _documentVisibilityTurnOffCleanup: {\n        value: null,\n        writable: true\n      },\n      _clientTrackSwitchOffControl: {\n        value: options.clientTrackSwitchOffControl\n      },\n      _contentPreferencesMode: {\n        value: options.contentPreferencesMode\n      },\n      _invisibleElements: {\n        value: new WeakSet()\n      },\n      _resizeObserver: {\n        value: new options.ResizeObserver(function (entries) {\n          // NOTE(mpatwardhan): we ignore elements in _invisibleElements\n          // to ensure that ResizeObserver does not end-up turning off a track when a fresh Video element is\n          // attached and IntersectionObserver has not had its callback executed yet.\n          var visibleElementResized = entries.find(function (entry) {\n            return !_this._invisibleElements.has(entry.target);\n          });\n\n          if (visibleElementResized) {\n            maybeUpdateRenderHints(_this);\n          }\n        })\n      },\n      _intersectionObserver: {\n        value: new options.IntersectionObserver(function (entries) {\n          var shouldSetRenderHint = false;\n          entries.forEach(function (entry) {\n            var wasVisible = !_this._invisibleElements.has(entry.target);\n\n            if (wasVisible !== entry.isIntersecting) {\n              if (entry.isIntersecting) {\n                _this._log.debug('intersectionObserver detected: Off => On');\n\n                _this._invisibleElements.delete(entry.target);\n              } else {\n                _this._log.debug('intersectionObserver detected: On => Off');\n\n                _this._invisibleElements.add(entry.target);\n              }\n\n              shouldSetRenderHint = true;\n            }\n          });\n\n          if (shouldSetRenderHint) {\n            maybeUpdateRenderHints(_this);\n          }\n        }, {\n          threshold: 0.25\n        })\n      }\n    });\n    return _this;\n  }\n  /**\n   * @private\n   */\n\n\n  _createClass(RemoteVideoTrack, [{\n    key: '_start',\n    value: function _start(dummyEl) {\n      var result = _get(RemoteVideoTrack.prototype.__proto__ || Object.getPrototypeOf(RemoteVideoTrack.prototype), '_start', this).call(this, dummyEl); // NOTE(mpatwardhan): after emitting started, update render hints only if clientTrackSwitchOffControl is 'auto'.\n\n\n      if (this._clientTrackSwitchOffControl === 'auto') {\n        maybeUpdateRenderHints(this);\n      }\n\n      return result;\n    }\n    /**\n     * Request to switch on a {@link RemoteVideoTrack}, This method is applicable only for the group rooms and only when connected with\n     * clientTrackSwitchOffControl in video bandwidth profile options set to 'manual'\n     * @returns {this}\n     */\n\n  }, {\n    key: 'switchOn',\n    value: function switchOn() {\n      if (this._clientTrackSwitchOffControl !== 'manual') {\n        throw new Error('Invalid state. You can call switchOn only when bandwidthProfile.video.clientTrackSwitchOffControl is set to \"manual\"');\n      }\n\n      this._setRenderHint({\n        enabled: true\n      });\n\n      return this;\n    }\n    /**\n     * Request to switch off a {@link RemoteVideoTrack}, This method is applicable only for the group rooms and only when connected with\n     * clientTrackSwitchOffControl in video bandwidth profile options set to 'manual'\n     * @returns {this}\n     */\n\n  }, {\n    key: 'switchOff',\n    value: function switchOff() {\n      if (this._clientTrackSwitchOffControl !== 'manual') {\n        throw new Error('Invalid state. You can call switchOff only when bandwidthProfile.video.clientTrackSwitchOffControl is set to \"manual\"');\n      }\n\n      this._setRenderHint({\n        enabled: false\n      });\n\n      return this;\n    }\n    /**\n     * Set the {@link RemoteVideoTrack}'s content preferences. This method is applicable only for the group rooms and only when connected with\n     * videoContentPreferencesMode in video bandwidth profile options set to 'manual'\n     * @param {VideoContentPreferences} contentPreferences - requested preferences.\n     * @returns {this}\n     */\n\n  }, {\n    key: 'setContentPreferences',\n    value: function setContentPreferences(contentPreferences) {\n      if (this._contentPreferencesMode !== 'manual') {\n        throw new Error('Invalid state. You can call switchOn only when bandwidthProfile.video.contentPreferencesMode is set to \"manual\"');\n      }\n\n      if (contentPreferences.renderDimensions) {\n        this._setRenderHint({\n          renderDimensions: contentPreferences.renderDimensions\n        });\n      }\n\n      return this;\n    }\n  }, {\n    key: 'attach',\n    value: function attach(el) {\n      var result = _get(RemoteVideoTrack.prototype.__proto__ || Object.getPrototypeOf(RemoteVideoTrack.prototype), 'attach', this).call(this, el);\n\n      if (this._clientTrackSwitchOffControl === 'auto') {\n        // start off the element as invisible. will mark it\n        // visible once intersection observer calls back.\n        this._invisibleElements.add(result); // NOTE(mpatwardhan): we do not call maybeUpdateRenderHints here,\n        // because the dimensions are not known for freshly created\n        // elements. we will get non-zero dimensions in _intersectionObserver\n        // callback and then will call maybeUpdateRenderHints.\n\n      }\n\n      this._intersectionObserver.observe(result);\n\n      this._resizeObserver.observe(result);\n\n      if (this._enableDocumentVisibilityTurnOff) {\n        this._documentVisibilityTurnOffCleanup = this._documentVisibilityTurnOffCleanup || setupDocumentVisibilityTurnOff(this);\n      }\n\n      return result;\n    }\n  }, {\n    key: 'detach',\n    value: function detach(el) {\n      var _this2 = this;\n\n      var result = _get(RemoteVideoTrack.prototype.__proto__ || Object.getPrototypeOf(RemoteVideoTrack.prototype), 'detach', this).call(this, el);\n\n      var elements = Array.isArray(result) ? result : [result];\n      elements.forEach(function (element) {\n        _this2._intersectionObserver.unobserve(element);\n\n        _this2._resizeObserver.unobserve(element);\n\n        _this2._invisibleElements.delete(element);\n      });\n\n      if (this._attachments.size === 0) {\n        if (this._documentVisibilityTurnOffCleanup) {\n          this._documentVisibilityTurnOffCleanup();\n\n          this._documentVisibilityTurnOffCleanup = null;\n        }\n      }\n\n      maybeUpdateRenderHints(this);\n      return result;\n    }\n    /**\n     * Add a {@link VideoProcessor} to allow for custom processing of video frames belonging to a VideoTrack.\n     * When a Participant un-publishes and re-publishes a VideoTrack, a new RemoteVideoTrack is created and\n     * any VideoProcessors attached to the previous RemoteVideoTrack would have to be re-added again.\n     * Only Chrome supports this as of now. Calling this API from a non-supported browser will result in a log warning.\n     * @param {VideoProcessor} processor - The {@link VideoProcessor} to use.\n     * @returns {this}\n     * @example\n     * class GrayScaleProcessor {\n     *   constructor(percentage) {\n     *     this.percentage = percentage;\n     *   }\n     *   processFrame(inputFrameBuffer, outputFrameBuffer) {\n     *     const context = outputFrameBuffer.getContext('2d');\n     *     context.filter = `grayscale(${this.percentage}%)`;\n     *     context.drawImage(inputFrameBuffer, 0, 0, inputFrameBuffer.width, inputFrameBuffer.height);\n     *   }\n     * }\n     *\n     * const grayscaleProcessor = new GrayScaleProcessor(100);\n     *\n     * Array.from(room.participants.values()).forEach(participant => {\n     *   const remoteVideoTrack = Array.from(participant.videoTracks.values())[0].track;\n     *   remoteVideoTrack.addProcessor(grayscaleProcessor);\n     * });\n     */\n\n  }, {\n    key: 'addProcessor',\n    value: function addProcessor() {\n      return _get(RemoteVideoTrack.prototype.__proto__ || Object.getPrototypeOf(RemoteVideoTrack.prototype), 'addProcessor', this).apply(this, arguments);\n    }\n    /**\n     * Remove the previously added {@link VideoProcessor} using `addProcessor` API.\n     * @param {VideoProcessor} processor - The {@link VideoProcessor} to remove.\n     * @returns {this}\n     * @example\n     * class GrayScaleProcessor {\n     *   constructor(percentage) {\n     *     this.percentage = percentage;\n     *   }\n     *   processFrame(inputFrameBuffer, outputFrameBuffer) {\n     *     const context = outputFrameBuffer.getContext('2d');\n     *     context.filter = `grayscale(${this.percentage}%)`;\n     *     context.drawImage(inputFrameBuffer, 0, 0, inputFrameBuffer.width, inputFrameBuffer.height);\n     *   }\n     * }\n     *\n     * const grayscaleProcessor = new GrayScaleProcessor(100);\n     *\n     * Array.from(room.participants.values()).forEach(participant => {\n     *   const remoteVideoTrack = Array.from(participant.videoTracks.values())[0].track;\n     *   remoteVideoTrack.addProcessor(grayscaleProcessor);\n     * });\n     *\n     * document.getElementById('remove-button').onclick = () => {\n     *   Array.from(room.participants.values()).forEach(participant => {\n     *     const remoteVideoTrack = Array.from(participant.videoTracks.values())[0].track;\n     *     remoteVideoTrack.removeProcessor(grayscaleProcessor);\n     *   });\n     * }\n     */\n\n  }, {\n    key: 'removeProcessor',\n    value: function removeProcessor() {\n      return _get(RemoteVideoTrack.prototype.__proto__ || Object.getPrototypeOf(RemoteVideoTrack.prototype), 'removeProcessor', this).apply(this, arguments);\n    }\n  }, {\n    key: 'toString',\n    value: function toString() {\n      return '[RemoteVideoTrack #' + this._instanceId + ': ' + this.sid + ']';\n    }\n    /**\n     * Update the subscribe {@link Track.Priority} of the {@link RemoteVideoTrack}.\n     * @param {?Track.Priority} priority - the new subscribe {@link Track.Priority};\n     *   If <code>null</code>, then the subscribe {@link Track.Priority} is cleared, which\n     *   means the {@link Track.Priority} set by the publisher is now the effective priority.\n     * @returns {this}\n     * @throws {RangeError}\n     */\n\n  }, {\n    key: 'setPriority',\n    value: function setPriority(priority) {\n      return _get(RemoteVideoTrack.prototype.__proto__ || Object.getPrototypeOf(RemoteVideoTrack.prototype), 'setPriority', this).call(this, priority);\n    }\n  }]);\n\n  return RemoteVideoTrack;\n}(RemoteMediaVideoTrack);\n\nfunction setupDocumentVisibilityTurnOff(removeVideoTrack) {\n  function onVisibilityChanged() {\n    maybeUpdateRenderHints(removeVideoTrack);\n  }\n\n  documentVisibilityMonitor.onVisibilityChange(1, onVisibilityChanged);\n  return function () {\n    documentVisibilityMonitor.offVisibilityChange(1, onVisibilityChanged);\n  };\n}\n\nfunction maybeUpdateRenderHints(removeVideoTrack) {\n  // maybeUpdateRenderHints is applicable only for \"auto\" modes.\n  if (removeVideoTrack._clientTrackSwitchOffControl !== 'auto' && removeVideoTrack._contentPreferencesMode !== 'auto') {\n    return;\n  }\n\n  var elements = removeVideoTrack._getAllAttachedElements();\n\n  var updatedRenderHint = {};\n\n  if (removeVideoTrack._clientTrackSwitchOffControl === 'auto') {\n    // consider only visible elements.\n    elements = elements.filter(function (el) {\n      return !removeVideoTrack._invisibleElements.has(el);\n    });\n    updatedRenderHint.enabled = document.visibilityState === 'visible' && elements.length > 0;\n  }\n\n  if (removeVideoTrack._contentPreferencesMode === 'auto' && elements.length > 0) {\n    var _elements$sort = elements.sort(function (el1, el2) {\n      return el2.clientHeight + el2.clientWidth - el1.clientHeight - el1.clientWidth - 1;\n    }),\n        _elements$sort2 = _slicedToArray(_elements$sort, 1),\n        _elements$sort2$ = _elements$sort2[0],\n        clientHeight = _elements$sort2$.clientHeight,\n        clientWidth = _elements$sort2$.clientWidth;\n\n    updatedRenderHint.renderDimensions = {\n      height: clientHeight,\n      width: clientWidth\n    };\n  }\n\n  removeVideoTrack._log.debug('updating render hint:', updatedRenderHint);\n\n  removeVideoTrack._setRenderHint(updatedRenderHint);\n}\n/**\n * @typedef {object} VideoContentPreferences\n * @property {VideoTrack.Dimensions} [renderDimensions] - Render Dimensions to request for the {@link RemoteVideoTrack}.\n */\n\n/**\n * The {@link RemoteVideoTrack}'s dimensions changed.\n * @param {RemoteVideoTrack} track - The {@link RemoteVideoTrack} whose\n *   dimensions changed\n * @event RemoteVideoTrack#dimensionsChanged\n */\n\n/**\n * The {@link RemoteVideoTrack} was disabled, i.e. \"paused\".\n * @param {RemoteVideoTrack} track - The {@link RemoteVideoTrack} that was\n *   disabled\n * @event RemoteVideoTrack#disabled\n */\n\n/**\n * The {@link RemoteVideoTrack} was enabled, i.e. \"resumed\".\n * @param {RemoteVideoTrack} track - The {@link RemoteVideoTrack} that was\n *   enabled\n * @event RemoteVideoTrack#enabled\n */\n\n/**\n * The {@link RemoteVideoTrack} started. This means there is enough video data\n * to begin playback.\n * @param {RemoteVideoTrack} track - The {@link RemoteVideoTrack} that started\n * @event RemoteVideoTrack#started\n */\n\n/**\n * A {@link RemoteVideoTrack} was switched off.\n * @param {RemoteVideoTrack} track - The {@link RemoteVideoTrack} that was\n *   switched off\n * @event RemoteVideoTrack#switchedOff\n */\n\n/**\n * A {@link RemoteVideoTrack} was switched on.\n * @param {RemoteVideoTrack} track - The {@link RemoteVideoTrack} that was\n *   switched on\n * @event RemoteVideoTrack#switchedOn\n */\n\n\nmodule.exports = RemoteVideoTrack;","map":{"version":3,"sources":["/Users/shouryagupta/Desktop/MS Engage 21/MSEngage21_VC/node_modules/twilio-video/es5/media/track/remotevideotrack.js"],"names":["_slicedToArray","sliceIterator","arr","i","_arr","_n","_d","_e","undefined","_i","Symbol","iterator","_s","next","done","push","value","length","err","Array","isArray","Object","TypeError","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","defineProperty","key","Constructor","protoProps","staticProps","prototype","_get","get","object","property","receiver","Function","desc","getOwnPropertyDescriptor","parent","getPrototypeOf","getter","call","_classCallCheck","instance","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","constructor","setPrototypeOf","__proto__","mixinRemoteMediaTrack","require","VideoTrack","documentVisibilityMonitor","_require","NullObserver","RemoteMediaVideoTrack","RemoteVideoTrack","_RemoteMediaVideoTrac","sid","mediaTrackReceiver","isEnabled","isSwitchedOff","setPriority","setRenderHint","options","assign","clientTrackSwitchOffControl","contentPreferencesMode","enableDocumentVisibilityTurnOff","IntersectionObserver","ResizeObserver","_this","_enableDocumentVisibilityTurnOff","_documentVisibilityTurnOffCleanup","_clientTrackSwitchOffControl","_contentPreferencesMode","_invisibleElements","WeakSet","_resizeObserver","entries","visibleElementResized","find","entry","has","maybeUpdateRenderHints","_intersectionObserver","shouldSetRenderHint","forEach","wasVisible","isIntersecting","_log","debug","delete","add","threshold","_start","dummyEl","result","switchOn","Error","_setRenderHint","enabled","switchOff","setContentPreferences","contentPreferences","renderDimensions","attach","el","observe","setupDocumentVisibilityTurnOff","detach","_this2","elements","element","unobserve","_attachments","size","addProcessor","apply","arguments","removeProcessor","toString","_instanceId","priority","removeVideoTrack","onVisibilityChanged","onVisibilityChange","offVisibilityChange","_getAllAttachedElements","updatedRenderHint","filter","document","visibilityState","_elements$sort","sort","el1","el2","clientHeight","clientWidth","_elements$sort2","_elements$sort2$","height","width","module","exports"],"mappings":"AAAA;;AAEA,IAAIA,cAAc,GAAG,YAAY;AAAE,WAASC,aAAT,CAAuBC,GAAvB,EAA4BC,CAA5B,EAA+B;AAAE,QAAIC,IAAI,GAAG,EAAX;AAAe,QAAIC,EAAE,GAAG,IAAT;AAAe,QAAIC,EAAE,GAAG,KAAT;AAAgB,QAAIC,EAAE,GAAGC,SAAT;;AAAoB,QAAI;AAAE,WAAK,IAAIC,EAAE,GAAGP,GAAG,CAACQ,MAAM,CAACC,QAAR,CAAH,EAAT,EAAiCC,EAAtC,EAA0C,EAAEP,EAAE,GAAG,CAACO,EAAE,GAAGH,EAAE,CAACI,IAAH,EAAN,EAAiBC,IAAxB,CAA1C,EAAyET,EAAE,GAAG,IAA9E,EAAoF;AAAED,QAAAA,IAAI,CAACW,IAAL,CAAUH,EAAE,CAACI,KAAb;;AAAqB,YAAIb,CAAC,IAAIC,IAAI,CAACa,MAAL,KAAgBd,CAAzB,EAA4B;AAAQ;AAAE,KAAvJ,CAAwJ,OAAOe,GAAP,EAAY;AAAEZ,MAAAA,EAAE,GAAG,IAAL;AAAWC,MAAAA,EAAE,GAAGW,GAAL;AAAW,KAA5L,SAAqM;AAAE,UAAI;AAAE,YAAI,CAACb,EAAD,IAAOI,EAAE,CAAC,QAAD,CAAb,EAAyBA,EAAE,CAAC,QAAD,CAAF;AAAiB,OAAhD,SAAyD;AAAE,YAAIH,EAAJ,EAAQ,MAAMC,EAAN;AAAW;AAAE;;AAAC,WAAOH,IAAP;AAAc;;AAAC,SAAO,UAAUF,GAAV,EAAeC,CAAf,EAAkB;AAAE,QAAIgB,KAAK,CAACC,OAAN,CAAclB,GAAd,CAAJ,EAAwB;AAAE,aAAOA,GAAP;AAAa,KAAvC,MAA6C,IAAIQ,MAAM,CAACC,QAAP,IAAmBU,MAAM,CAACnB,GAAD,CAA7B,EAAoC;AAAE,aAAOD,aAAa,CAACC,GAAD,EAAMC,CAAN,CAApB;AAA+B,KAArE,MAA2E;AAAE,YAAM,IAAImB,SAAJ,CAAc,sDAAd,CAAN;AAA8E;AAAE,GAArO;AAAwO,CAAhoB,EAArB;;AAEA,IAAIC,YAAY,GAAG,YAAY;AAAE,WAASC,gBAAT,CAA0BC,MAA1B,EAAkCC,KAAlC,EAAyC;AAAE,SAAK,IAAIvB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGuB,KAAK,CAACT,MAA1B,EAAkCd,CAAC,EAAnC,EAAuC;AAAE,UAAIwB,UAAU,GAAGD,KAAK,CAACvB,CAAD,CAAtB;AAA2BwB,MAAAA,UAAU,CAACC,UAAX,GAAwBD,UAAU,CAACC,UAAX,IAAyB,KAAjD;AAAwDD,MAAAA,UAAU,CAACE,YAAX,GAA0B,IAA1B;AAAgC,UAAI,WAAWF,UAAf,EAA2BA,UAAU,CAACG,QAAX,GAAsB,IAAtB;AAA4BT,MAAAA,MAAM,CAACU,cAAP,CAAsBN,MAAtB,EAA8BE,UAAU,CAACK,GAAzC,EAA8CL,UAA9C;AAA4D;AAAE;;AAAC,SAAO,UAAUM,WAAV,EAAuBC,UAAvB,EAAmCC,WAAnC,EAAgD;AAAE,QAAID,UAAJ,EAAgBV,gBAAgB,CAACS,WAAW,CAACG,SAAb,EAAwBF,UAAxB,CAAhB;AAAqD,QAAIC,WAAJ,EAAiBX,gBAAgB,CAACS,WAAD,EAAcE,WAAd,CAAhB;AAA4C,WAAOF,WAAP;AAAqB,GAAhN;AAAmN,CAA9hB,EAAnB;;AAEA,IAAII,IAAI,GAAG,SAASC,GAAT,CAAaC,MAAb,EAAqBC,QAArB,EAA+BC,QAA/B,EAAyC;AAAE,MAAIF,MAAM,KAAK,IAAf,EAAqBA,MAAM,GAAGG,QAAQ,CAACN,SAAlB;AAA6B,MAAIO,IAAI,GAAGtB,MAAM,CAACuB,wBAAP,CAAgCL,MAAhC,EAAwCC,QAAxC,CAAX;;AAA8D,MAAIG,IAAI,KAAKnC,SAAb,EAAwB;AAAE,QAAIqC,MAAM,GAAGxB,MAAM,CAACyB,cAAP,CAAsBP,MAAtB,CAAb;;AAA4C,QAAIM,MAAM,KAAK,IAAf,EAAqB;AAAE,aAAOrC,SAAP;AAAmB,KAA1C,MAAgD;AAAE,aAAO8B,GAAG,CAACO,MAAD,EAASL,QAAT,EAAmBC,QAAnB,CAAV;AAAyC;AAAE,GAAnK,MAAyK,IAAI,WAAWE,IAAf,EAAqB;AAAE,WAAOA,IAAI,CAAC3B,KAAZ;AAAoB,GAA3C,MAAiD;AAAE,QAAI+B,MAAM,GAAGJ,IAAI,CAACL,GAAlB;;AAAuB,QAAIS,MAAM,KAAKvC,SAAf,EAA0B;AAAE,aAAOA,SAAP;AAAmB;;AAAC,WAAOuC,MAAM,CAACC,IAAP,CAAYP,QAAZ,CAAP;AAA+B;AAAE,CAA1e;;AAEA,SAASQ,eAAT,CAAyBC,QAAzB,EAAmCjB,WAAnC,EAAgD;AAAE,MAAI,EAAEiB,QAAQ,YAAYjB,WAAtB,CAAJ,EAAwC;AAAE,UAAM,IAAIX,SAAJ,CAAc,mCAAd,CAAN;AAA2D;AAAE;;AAEzJ,SAAS6B,0BAAT,CAAoCC,IAApC,EAA0CJ,IAA1C,EAAgD;AAAE,MAAI,CAACI,IAAL,EAAW;AAAE,UAAM,IAAIC,cAAJ,CAAmB,2DAAnB,CAAN;AAAwF;;AAAC,SAAOL,IAAI,KAAK,OAAOA,IAAP,KAAgB,QAAhB,IAA4B,OAAOA,IAAP,KAAgB,UAAjD,CAAJ,GAAmEA,IAAnE,GAA0EI,IAAjF;AAAwF;;AAEhP,SAASE,SAAT,CAAmBC,QAAnB,EAA6BC,UAA7B,EAAyC;AAAE,MAAI,OAAOA,UAAP,KAAsB,UAAtB,IAAoCA,UAAU,KAAK,IAAvD,EAA6D;AAAE,UAAM,IAAIlC,SAAJ,CAAc,6DAA6D,OAAOkC,UAAlF,CAAN;AAAsG;;AAACD,EAAAA,QAAQ,CAACnB,SAAT,GAAqBf,MAAM,CAACoC,MAAP,CAAcD,UAAU,IAAIA,UAAU,CAACpB,SAAvC,EAAkD;AAAEsB,IAAAA,WAAW,EAAE;AAAE1C,MAAAA,KAAK,EAAEuC,QAAT;AAAmB3B,MAAAA,UAAU,EAAE,KAA/B;AAAsCE,MAAAA,QAAQ,EAAE,IAAhD;AAAsDD,MAAAA,YAAY,EAAE;AAApE;AAAf,GAAlD,CAArB;AAAqK,MAAI2B,UAAJ,EAAgBnC,MAAM,CAACsC,cAAP,GAAwBtC,MAAM,CAACsC,cAAP,CAAsBJ,QAAtB,EAAgCC,UAAhC,CAAxB,GAAsED,QAAQ,CAACK,SAAT,GAAqBJ,UAA3F;AAAwG;;AAE9e,IAAIK,qBAAqB,GAAGC,OAAO,CAAC,oBAAD,CAAnC;;AACA,IAAIC,UAAU,GAAGD,OAAO,CAAC,cAAD,CAAxB;;AACA,IAAIE,yBAAyB,GAAGF,OAAO,CAAC,yCAAD,CAAvC;;AAEA,IAAIG,QAAQ,GAAGH,OAAO,CAAC,4BAAD,CAAtB;AAAA,IACII,YAAY,GAAGD,QAAQ,CAACC,YAD5B;;AAGA,IAAIC,qBAAqB,GAAGN,qBAAqB,CAACE,UAAD,CAAjD;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAIK,gBAAgB,GAAG,UAAUC,qBAAV,EAAiC;AACtDf,EAAAA,SAAS,CAACc,gBAAD,EAAmBC,qBAAnB,CAAT;AAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACE,WAASD,gBAAT,CAA0BE,GAA1B,EAA+BC,kBAA/B,EAAmDC,SAAnD,EAA8DC,aAA9D,EAA6EC,WAA7E,EAA0FC,aAA1F,EAAyGC,OAAzG,EAAkH;AAChH3B,IAAAA,eAAe,CAAC,IAAD,EAAOmB,gBAAP,CAAf;;AAEAQ,IAAAA,OAAO,GAAGvD,MAAM,CAACwD,MAAP,CAAc;AACtBC,MAAAA,2BAA2B,EAAE,MADP;AAEtBC,MAAAA,sBAAsB,EAAE,MAFF;AAGtBC,MAAAA,+BAA+B,EAAE;AAHX,KAAd,EAIPJ,OAJO,CAAV;AAMAA,IAAAA,OAAO,GAAGvD,MAAM,CAACwD,MAAP,CAAc;AACtBI,MAAAA,oBAAoB,EAAE,OAAOA,oBAAP,KAAgC,WAAhC,IAA+CL,OAAO,CAACE,2BAAR,KAAwC,MAAvF,GAAgGZ,YAAhG,GAA+Ge,oBAD/G;AAEtBC,MAAAA,cAAc,EAAE,OAAOA,cAAP,KAA0B,WAA1B,IAAyCN,OAAO,CAACG,sBAAR,KAAmC,MAA5E,GAAqFb,YAArF,GAAoGgB;AAF9F,KAAd,EAGPN,OAHO,CAAV;;AAKA,QAAIO,KAAK,GAAGhC,0BAA0B,CAAC,IAAD,EAAO,CAACiB,gBAAgB,CAACR,SAAjB,IAA8BvC,MAAM,CAACyB,cAAP,CAAsBsB,gBAAtB,CAA/B,EAAwEpB,IAAxE,CAA6E,IAA7E,EAAmFsB,GAAnF,EAAwFC,kBAAxF,EAA4GC,SAA5G,EAAuHC,aAAvH,EAAsIC,WAAtI,EAAmJC,aAAnJ,EAAkKC,OAAlK,CAAP,CAAtC;;AAEAvD,IAAAA,MAAM,CAACG,gBAAP,CAAwB2D,KAAxB,EAA+B;AAC7BC,MAAAA,gCAAgC,EAAE;AAChCpE,QAAAA,KAAK,EAAE4D,OAAO,CAACI,+BAAR,KAA4C,IAA5C,IAAoDJ,OAAO,CAACE,2BAAR,KAAwC;AADnE,OADL;AAI7BO,MAAAA,iCAAiC,EAAE;AACjCrE,QAAAA,KAAK,EAAE,IAD0B;AAEjCc,QAAAA,QAAQ,EAAE;AAFuB,OAJN;AAQ7BwD,MAAAA,4BAA4B,EAAE;AAC5BtE,QAAAA,KAAK,EAAE4D,OAAO,CAACE;AADa,OARD;AAW7BS,MAAAA,uBAAuB,EAAE;AACvBvE,QAAAA,KAAK,EAAE4D,OAAO,CAACG;AADQ,OAXI;AAc7BS,MAAAA,kBAAkB,EAAE;AAClBxE,QAAAA,KAAK,EAAE,IAAIyE,OAAJ;AADW,OAdS;AAiB7BC,MAAAA,eAAe,EAAE;AACf1E,QAAAA,KAAK,EAAE,IAAI4D,OAAO,CAACM,cAAZ,CAA2B,UAAUS,OAAV,EAAmB;AACnD;AACA;AACA;AACA,cAAIC,qBAAqB,GAAGD,OAAO,CAACE,IAAR,CAAa,UAAUC,KAAV,EAAiB;AACxD,mBAAO,CAACX,KAAK,CAACK,kBAAN,CAAyBO,GAAzB,CAA6BD,KAAK,CAACrE,MAAnC,CAAR;AACD,WAF2B,CAA5B;;AAGA,cAAImE,qBAAJ,EAA2B;AACzBI,YAAAA,sBAAsB,CAACb,KAAD,CAAtB;AACD;AACF,SAVM;AADQ,OAjBY;AA8B7Bc,MAAAA,qBAAqB,EAAE;AACrBjF,QAAAA,KAAK,EAAE,IAAI4D,OAAO,CAACK,oBAAZ,CAAiC,UAAUU,OAAV,EAAmB;AACzD,cAAIO,mBAAmB,GAAG,KAA1B;AACAP,UAAAA,OAAO,CAACQ,OAAR,CAAgB,UAAUL,KAAV,EAAiB;AAC/B,gBAAIM,UAAU,GAAG,CAACjB,KAAK,CAACK,kBAAN,CAAyBO,GAAzB,CAA6BD,KAAK,CAACrE,MAAnC,CAAlB;;AACA,gBAAI2E,UAAU,KAAKN,KAAK,CAACO,cAAzB,EAAyC;AACvC,kBAAIP,KAAK,CAACO,cAAV,EAA0B;AACxBlB,gBAAAA,KAAK,CAACmB,IAAN,CAAWC,KAAX,CAAiB,0CAAjB;;AACApB,gBAAAA,KAAK,CAACK,kBAAN,CAAyBgB,MAAzB,CAAgCV,KAAK,CAACrE,MAAtC;AACD,eAHD,MAGO;AACL0D,gBAAAA,KAAK,CAACmB,IAAN,CAAWC,KAAX,CAAiB,0CAAjB;;AACApB,gBAAAA,KAAK,CAACK,kBAAN,CAAyBiB,GAAzB,CAA6BX,KAAK,CAACrE,MAAnC;AACD;;AACDyE,cAAAA,mBAAmB,GAAG,IAAtB;AACD;AACF,WAZD;;AAaA,cAAIA,mBAAJ,EAAyB;AACvBF,YAAAA,sBAAsB,CAACb,KAAD,CAAtB;AACD;AACF,SAlBM,EAkBJ;AAAEuB,UAAAA,SAAS,EAAE;AAAb,SAlBI;AADc;AA9BM,KAA/B;AAoDA,WAAOvB,KAAP;AACD;AAED;AACF;AACA;;;AAGE5D,EAAAA,YAAY,CAAC6C,gBAAD,EAAmB,CAAC;AAC9BpC,IAAAA,GAAG,EAAE,QADyB;AAE9BhB,IAAAA,KAAK,EAAE,SAAS2F,MAAT,CAAgBC,OAAhB,EAAyB;AAC9B,UAAIC,MAAM,GAAGxE,IAAI,CAAC+B,gBAAgB,CAAChC,SAAjB,CAA2BwB,SAA3B,IAAwCvC,MAAM,CAACyB,cAAP,CAAsBsB,gBAAgB,CAAChC,SAAvC,CAAzC,EAA4F,QAA5F,EAAsG,IAAtG,CAAJ,CAAgHY,IAAhH,CAAqH,IAArH,EAA2H4D,OAA3H,CAAb,CAD8B,CAE9B;;;AACA,UAAI,KAAKtB,4BAAL,KAAsC,MAA1C,EAAkD;AAChDU,QAAAA,sBAAsB,CAAC,IAAD,CAAtB;AACD;;AACD,aAAOa,MAAP;AACD;AAED;AACJ;AACA;AACA;AACA;;AAfkC,GAAD,EAiB5B;AACD7E,IAAAA,GAAG,EAAE,UADJ;AAEDhB,IAAAA,KAAK,EAAE,SAAS8F,QAAT,GAAoB;AACzB,UAAI,KAAKxB,4BAAL,KAAsC,QAA1C,EAAoD;AAClD,cAAM,IAAIyB,KAAJ,CAAU,sHAAV,CAAN;AACD;;AACD,WAAKC,cAAL,CAAoB;AAAEC,QAAAA,OAAO,EAAE;AAAX,OAApB;;AACA,aAAO,IAAP;AACD;AAED;AACJ;AACA;AACA;AACA;;AAdK,GAjB4B,EAiC5B;AACDjF,IAAAA,GAAG,EAAE,WADJ;AAEDhB,IAAAA,KAAK,EAAE,SAASkG,SAAT,GAAqB;AAC1B,UAAI,KAAK5B,4BAAL,KAAsC,QAA1C,EAAoD;AAClD,cAAM,IAAIyB,KAAJ,CAAU,uHAAV,CAAN;AACD;;AACD,WAAKC,cAAL,CAAoB;AAAEC,QAAAA,OAAO,EAAE;AAAX,OAApB;;AACA,aAAO,IAAP;AACD;AAED;AACJ;AACA;AACA;AACA;AACA;;AAfK,GAjC4B,EAkD5B;AACDjF,IAAAA,GAAG,EAAE,uBADJ;AAEDhB,IAAAA,KAAK,EAAE,SAASmG,qBAAT,CAA+BC,kBAA/B,EAAmD;AACxD,UAAI,KAAK7B,uBAAL,KAAiC,QAArC,EAA+C;AAC7C,cAAM,IAAIwB,KAAJ,CAAU,iHAAV,CAAN;AACD;;AAED,UAAIK,kBAAkB,CAACC,gBAAvB,EAAyC;AACvC,aAAKL,cAAL,CAAoB;AAAEK,UAAAA,gBAAgB,EAAED,kBAAkB,CAACC;AAAvC,SAApB;AACD;;AACD,aAAO,IAAP;AACD;AAXA,GAlD4B,EA8D5B;AACDrF,IAAAA,GAAG,EAAE,QADJ;AAEDhB,IAAAA,KAAK,EAAE,SAASsG,MAAT,CAAgBC,EAAhB,EAAoB;AACzB,UAAIV,MAAM,GAAGxE,IAAI,CAAC+B,gBAAgB,CAAChC,SAAjB,CAA2BwB,SAA3B,IAAwCvC,MAAM,CAACyB,cAAP,CAAsBsB,gBAAgB,CAAChC,SAAvC,CAAzC,EAA4F,QAA5F,EAAsG,IAAtG,CAAJ,CAAgHY,IAAhH,CAAqH,IAArH,EAA2HuE,EAA3H,CAAb;;AAEA,UAAI,KAAKjC,4BAAL,KAAsC,MAA1C,EAAkD;AAChD;AACA;AACA,aAAKE,kBAAL,CAAwBiB,GAAxB,CAA4BI,MAA5B,EAHgD,CAKhD;AACA;AACA;AACA;;AACD;;AAED,WAAKZ,qBAAL,CAA2BuB,OAA3B,CAAmCX,MAAnC;;AACA,WAAKnB,eAAL,CAAqB8B,OAArB,CAA6BX,MAA7B;;AAEA,UAAI,KAAKzB,gCAAT,EAA2C;AACzC,aAAKC,iCAAL,GAAyC,KAAKA,iCAAL,IAA0CoC,8BAA8B,CAAC,IAAD,CAAjH;AACD;;AAED,aAAOZ,MAAP;AACD;AAxBA,GA9D4B,EAuF5B;AACD7E,IAAAA,GAAG,EAAE,QADJ;AAEDhB,IAAAA,KAAK,EAAE,SAAS0G,MAAT,CAAgBH,EAAhB,EAAoB;AACzB,UAAII,MAAM,GAAG,IAAb;;AAEA,UAAId,MAAM,GAAGxE,IAAI,CAAC+B,gBAAgB,CAAChC,SAAjB,CAA2BwB,SAA3B,IAAwCvC,MAAM,CAACyB,cAAP,CAAsBsB,gBAAgB,CAAChC,SAAvC,CAAzC,EAA4F,QAA5F,EAAsG,IAAtG,CAAJ,CAAgHY,IAAhH,CAAqH,IAArH,EAA2HuE,EAA3H,CAAb;;AACA,UAAIK,QAAQ,GAAGzG,KAAK,CAACC,OAAN,CAAcyF,MAAd,IAAwBA,MAAxB,GAAiC,CAACA,MAAD,CAAhD;AACAe,MAAAA,QAAQ,CAACzB,OAAT,CAAiB,UAAU0B,OAAV,EAAmB;AAClCF,QAAAA,MAAM,CAAC1B,qBAAP,CAA6B6B,SAA7B,CAAuCD,OAAvC;;AACAF,QAAAA,MAAM,CAACjC,eAAP,CAAuBoC,SAAvB,CAAiCD,OAAjC;;AACAF,QAAAA,MAAM,CAACnC,kBAAP,CAA0BgB,MAA1B,CAAiCqB,OAAjC;AACD,OAJD;;AAMA,UAAI,KAAKE,YAAL,CAAkBC,IAAlB,KAA2B,CAA/B,EAAkC;AAChC,YAAI,KAAK3C,iCAAT,EAA4C;AAC1C,eAAKA,iCAAL;;AACA,eAAKA,iCAAL,GAAyC,IAAzC;AACD;AACF;;AAEDW,MAAAA,sBAAsB,CAAC,IAAD,CAAtB;AACA,aAAOa,MAAP;AACD;AAED;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAjDK,GAvF4B,EA0I5B;AACD7E,IAAAA,GAAG,EAAE,cADJ;AAEDhB,IAAAA,KAAK,EAAE,SAASiH,YAAT,GAAwB;AAC7B,aAAO5F,IAAI,CAAC+B,gBAAgB,CAAChC,SAAjB,CAA2BwB,SAA3B,IAAwCvC,MAAM,CAACyB,cAAP,CAAsBsB,gBAAgB,CAAChC,SAAvC,CAAzC,EAA4F,cAA5F,EAA4G,IAA5G,CAAJ,CAAsH8F,KAAtH,CAA4H,IAA5H,EAAkIC,SAAlI,CAAP;AACD;AAED;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAnCK,GA1I4B,EA+K5B;AACDnG,IAAAA,GAAG,EAAE,iBADJ;AAEDhB,IAAAA,KAAK,EAAE,SAASoH,eAAT,GAA2B;AAChC,aAAO/F,IAAI,CAAC+B,gBAAgB,CAAChC,SAAjB,CAA2BwB,SAA3B,IAAwCvC,MAAM,CAACyB,cAAP,CAAsBsB,gBAAgB,CAAChC,SAAvC,CAAzC,EAA4F,iBAA5F,EAA+G,IAA/G,CAAJ,CAAyH8F,KAAzH,CAA+H,IAA/H,EAAqIC,SAArI,CAAP;AACD;AAJA,GA/K4B,EAoL5B;AACDnG,IAAAA,GAAG,EAAE,UADJ;AAEDhB,IAAAA,KAAK,EAAE,SAASqH,QAAT,GAAoB;AACzB,aAAO,wBAAwB,KAAKC,WAA7B,GAA2C,IAA3C,GAAkD,KAAKhE,GAAvD,GAA6D,GAApE;AACD;AAED;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;AAbK,GApL4B,EAmM5B;AACDtC,IAAAA,GAAG,EAAE,aADJ;AAEDhB,IAAAA,KAAK,EAAE,SAAS0D,WAAT,CAAqB6D,QAArB,EAA+B;AACpC,aAAOlG,IAAI,CAAC+B,gBAAgB,CAAChC,SAAjB,CAA2BwB,SAA3B,IAAwCvC,MAAM,CAACyB,cAAP,CAAsBsB,gBAAgB,CAAChC,SAAvC,CAAzC,EAA4F,aAA5F,EAA2G,IAA3G,CAAJ,CAAqHY,IAArH,CAA0H,IAA1H,EAAgIuF,QAAhI,CAAP;AACD;AAJA,GAnM4B,CAAnB,CAAZ;;AA0MA,SAAOnE,gBAAP;AACD,CArSsB,CAqSrBD,qBArSqB,CAAvB;;AAuSA,SAASsD,8BAAT,CAAwCe,gBAAxC,EAA0D;AACxD,WAASC,mBAAT,GAA+B;AAC7BzC,IAAAA,sBAAsB,CAACwC,gBAAD,CAAtB;AACD;;AAEDxE,EAAAA,yBAAyB,CAAC0E,kBAA1B,CAA6C,CAA7C,EAAgDD,mBAAhD;AACA,SAAO,YAAY;AACjBzE,IAAAA,yBAAyB,CAAC2E,mBAA1B,CAA8C,CAA9C,EAAiDF,mBAAjD;AACD,GAFD;AAGD;;AAED,SAASzC,sBAAT,CAAgCwC,gBAAhC,EAAkD;AAChD;AACA,MAAIA,gBAAgB,CAAClD,4BAAjB,KAAkD,MAAlD,IAA4DkD,gBAAgB,CAACjD,uBAAjB,KAA6C,MAA7G,EAAqH;AACnH;AACD;;AAED,MAAIqC,QAAQ,GAAGY,gBAAgB,CAACI,uBAAjB,EAAf;;AACA,MAAIC,iBAAiB,GAAG,EAAxB;;AACA,MAAIL,gBAAgB,CAAClD,4BAAjB,KAAkD,MAAtD,EAA8D;AAC5D;AACAsC,IAAAA,QAAQ,GAAGA,QAAQ,CAACkB,MAAT,CAAgB,UAAUvB,EAAV,EAAc;AACvC,aAAO,CAACiB,gBAAgB,CAAChD,kBAAjB,CAAoCO,GAApC,CAAwCwB,EAAxC,CAAR;AACD,KAFU,CAAX;AAGAsB,IAAAA,iBAAiB,CAAC5B,OAAlB,GAA4B8B,QAAQ,CAACC,eAAT,KAA6B,SAA7B,IAA0CpB,QAAQ,CAAC3G,MAAT,GAAkB,CAAxF;AACD;;AAED,MAAIuH,gBAAgB,CAACjD,uBAAjB,KAA6C,MAA7C,IAAuDqC,QAAQ,CAAC3G,MAAT,GAAkB,CAA7E,EAAgF;AAC9E,QAAIgI,cAAc,GAAGrB,QAAQ,CAACsB,IAAT,CAAc,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AACrD,aAAOA,GAAG,CAACC,YAAJ,GAAmBD,GAAG,CAACE,WAAvB,GAAqCH,GAAG,CAACE,YAAzC,GAAwDF,GAAG,CAACG,WAA5D,GAA0E,CAAjF;AACD,KAFoB,CAArB;AAAA,QAGIC,eAAe,GAAGvJ,cAAc,CAACiJ,cAAD,EAAiB,CAAjB,CAHpC;AAAA,QAIIO,gBAAgB,GAAGD,eAAe,CAAC,CAAD,CAJtC;AAAA,QAKIF,YAAY,GAAGG,gBAAgB,CAACH,YALpC;AAAA,QAMIC,WAAW,GAAGE,gBAAgB,CAACF,WANnC;;AAQAT,IAAAA,iBAAiB,CAACxB,gBAAlB,GAAqC;AAAEoC,MAAAA,MAAM,EAAEJ,YAAV;AAAwBK,MAAAA,KAAK,EAAEJ;AAA/B,KAArC;AACD;;AAEDd,EAAAA,gBAAgB,CAAClC,IAAjB,CAAsBC,KAAtB,CAA4B,uBAA5B,EAAqDsC,iBAArD;;AACAL,EAAAA,gBAAgB,CAACxB,cAAjB,CAAgC6B,iBAAhC;AACD;AACD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAEAc,MAAM,CAACC,OAAP,GAAiBxF,gBAAjB","sourcesContent":["'use strict';\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar mixinRemoteMediaTrack = require('./remotemediatrack');\nvar VideoTrack = require('./videotrack');\nvar documentVisibilityMonitor = require('../../util/documentvisibilitymonitor.js');\n\nvar _require = require('../../util/nullobserver.js'),\n    NullObserver = _require.NullObserver;\n\nvar RemoteMediaVideoTrack = mixinRemoteMediaTrack(VideoTrack);\n\n/**\n * A {@link RemoteVideoTrack} represents a {@link VideoTrack} published to a\n * {@link Room} by a {@link RemoteParticipant}.\n * @extends VideoTrack\n * @property {boolean} isEnabled - Whether the {@link RemoteVideoTrack} is enabled\n * @property {boolean} isSwitchedOff - Whether the {@link RemoteVideoTrack} is switched off\n * @property {Track.SID} sid - The {@link RemoteVideoTrack}'s SID\n * @property {?Track.Priority} priority - The subscribe priority of the {@link RemoteVideoTrack}\n * @emits RemoteVideoTrack#dimensionsChanged\n * @emits RemoteVideoTrack#disabled\n * @emits RemoteVideoTrack#enabled\n * @emits RemoteVideoTrack#started\n * @emits RemoteVideoTrack#switchedOff\n * @emits RemoteVideoTrack#switchedOn\n */\n\nvar RemoteVideoTrack = function (_RemoteMediaVideoTrac) {\n  _inherits(RemoteVideoTrack, _RemoteMediaVideoTrac);\n\n  /**\n   * Construct a {@link RemoteVideoTrack}.\n   * @param {Track.SID} sid - The {@link RemoteVideoTrack}'s SID\n   * @param {MediaTrackReceiver} mediaTrackReceiver - A video MediaStreamTrack container\n   * @param {boolean} isEnabled - whether the {@link RemoteVideoTrack} is enabled\n   * @param {boolean} isSwitchedOff - Whether the {@link RemoteVideoTrack} is switched off\n   * @param {function(?Track.Priority): void} setPriority - Set or clear the subscribe\n   *  {@link Track.Priority} of the {@link RemoteVideoTrack}\n   * @param {function(ClientRenderHint): void} setRenderHint - Set render hints.\n   * @param {{log: Log}} options - The {@link RemoteTrack} options\n   */\n  function RemoteVideoTrack(sid, mediaTrackReceiver, isEnabled, isSwitchedOff, setPriority, setRenderHint, options) {\n    _classCallCheck(this, RemoteVideoTrack);\n\n    options = Object.assign({\n      clientTrackSwitchOffControl: 'auto',\n      contentPreferencesMode: 'auto',\n      enableDocumentVisibilityTurnOff: true\n    }, options);\n\n    options = Object.assign({\n      IntersectionObserver: typeof IntersectionObserver === 'undefined' || options.clientTrackSwitchOffControl !== 'auto' ? NullObserver : IntersectionObserver,\n      ResizeObserver: typeof ResizeObserver === 'undefined' || options.contentPreferencesMode !== 'auto' ? NullObserver : ResizeObserver\n    }, options);\n\n    var _this = _possibleConstructorReturn(this, (RemoteVideoTrack.__proto__ || Object.getPrototypeOf(RemoteVideoTrack)).call(this, sid, mediaTrackReceiver, isEnabled, isSwitchedOff, setPriority, setRenderHint, options));\n\n    Object.defineProperties(_this, {\n      _enableDocumentVisibilityTurnOff: {\n        value: options.enableDocumentVisibilityTurnOff === true && options.clientTrackSwitchOffControl === 'auto'\n      },\n      _documentVisibilityTurnOffCleanup: {\n        value: null,\n        writable: true\n      },\n      _clientTrackSwitchOffControl: {\n        value: options.clientTrackSwitchOffControl\n      },\n      _contentPreferencesMode: {\n        value: options.contentPreferencesMode\n      },\n      _invisibleElements: {\n        value: new WeakSet()\n      },\n      _resizeObserver: {\n        value: new options.ResizeObserver(function (entries) {\n          // NOTE(mpatwardhan): we ignore elements in _invisibleElements\n          // to ensure that ResizeObserver does not end-up turning off a track when a fresh Video element is\n          // attached and IntersectionObserver has not had its callback executed yet.\n          var visibleElementResized = entries.find(function (entry) {\n            return !_this._invisibleElements.has(entry.target);\n          });\n          if (visibleElementResized) {\n            maybeUpdateRenderHints(_this);\n          }\n        })\n      },\n      _intersectionObserver: {\n        value: new options.IntersectionObserver(function (entries) {\n          var shouldSetRenderHint = false;\n          entries.forEach(function (entry) {\n            var wasVisible = !_this._invisibleElements.has(entry.target);\n            if (wasVisible !== entry.isIntersecting) {\n              if (entry.isIntersecting) {\n                _this._log.debug('intersectionObserver detected: Off => On');\n                _this._invisibleElements.delete(entry.target);\n              } else {\n                _this._log.debug('intersectionObserver detected: On => Off');\n                _this._invisibleElements.add(entry.target);\n              }\n              shouldSetRenderHint = true;\n            }\n          });\n          if (shouldSetRenderHint) {\n            maybeUpdateRenderHints(_this);\n          }\n        }, { threshold: 0.25 })\n      }\n    });\n    return _this;\n  }\n\n  /**\n   * @private\n   */\n\n\n  _createClass(RemoteVideoTrack, [{\n    key: '_start',\n    value: function _start(dummyEl) {\n      var result = _get(RemoteVideoTrack.prototype.__proto__ || Object.getPrototypeOf(RemoteVideoTrack.prototype), '_start', this).call(this, dummyEl);\n      // NOTE(mpatwardhan): after emitting started, update render hints only if clientTrackSwitchOffControl is 'auto'.\n      if (this._clientTrackSwitchOffControl === 'auto') {\n        maybeUpdateRenderHints(this);\n      }\n      return result;\n    }\n\n    /**\n     * Request to switch on a {@link RemoteVideoTrack}, This method is applicable only for the group rooms and only when connected with\n     * clientTrackSwitchOffControl in video bandwidth profile options set to 'manual'\n     * @returns {this}\n     */\n\n  }, {\n    key: 'switchOn',\n    value: function switchOn() {\n      if (this._clientTrackSwitchOffControl !== 'manual') {\n        throw new Error('Invalid state. You can call switchOn only when bandwidthProfile.video.clientTrackSwitchOffControl is set to \"manual\"');\n      }\n      this._setRenderHint({ enabled: true });\n      return this;\n    }\n\n    /**\n     * Request to switch off a {@link RemoteVideoTrack}, This method is applicable only for the group rooms and only when connected with\n     * clientTrackSwitchOffControl in video bandwidth profile options set to 'manual'\n     * @returns {this}\n     */\n\n  }, {\n    key: 'switchOff',\n    value: function switchOff() {\n      if (this._clientTrackSwitchOffControl !== 'manual') {\n        throw new Error('Invalid state. You can call switchOff only when bandwidthProfile.video.clientTrackSwitchOffControl is set to \"manual\"');\n      }\n      this._setRenderHint({ enabled: false });\n      return this;\n    }\n\n    /**\n     * Set the {@link RemoteVideoTrack}'s content preferences. This method is applicable only for the group rooms and only when connected with\n     * videoContentPreferencesMode in video bandwidth profile options set to 'manual'\n     * @param {VideoContentPreferences} contentPreferences - requested preferences.\n     * @returns {this}\n     */\n\n  }, {\n    key: 'setContentPreferences',\n    value: function setContentPreferences(contentPreferences) {\n      if (this._contentPreferencesMode !== 'manual') {\n        throw new Error('Invalid state. You can call switchOn only when bandwidthProfile.video.contentPreferencesMode is set to \"manual\"');\n      }\n\n      if (contentPreferences.renderDimensions) {\n        this._setRenderHint({ renderDimensions: contentPreferences.renderDimensions });\n      }\n      return this;\n    }\n  }, {\n    key: 'attach',\n    value: function attach(el) {\n      var result = _get(RemoteVideoTrack.prototype.__proto__ || Object.getPrototypeOf(RemoteVideoTrack.prototype), 'attach', this).call(this, el);\n\n      if (this._clientTrackSwitchOffControl === 'auto') {\n        // start off the element as invisible. will mark it\n        // visible once intersection observer calls back.\n        this._invisibleElements.add(result);\n\n        // NOTE(mpatwardhan): we do not call maybeUpdateRenderHints here,\n        // because the dimensions are not known for freshly created\n        // elements. we will get non-zero dimensions in _intersectionObserver\n        // callback and then will call maybeUpdateRenderHints.\n      }\n\n      this._intersectionObserver.observe(result);\n      this._resizeObserver.observe(result);\n\n      if (this._enableDocumentVisibilityTurnOff) {\n        this._documentVisibilityTurnOffCleanup = this._documentVisibilityTurnOffCleanup || setupDocumentVisibilityTurnOff(this);\n      }\n\n      return result;\n    }\n  }, {\n    key: 'detach',\n    value: function detach(el) {\n      var _this2 = this;\n\n      var result = _get(RemoteVideoTrack.prototype.__proto__ || Object.getPrototypeOf(RemoteVideoTrack.prototype), 'detach', this).call(this, el);\n      var elements = Array.isArray(result) ? result : [result];\n      elements.forEach(function (element) {\n        _this2._intersectionObserver.unobserve(element);\n        _this2._resizeObserver.unobserve(element);\n        _this2._invisibleElements.delete(element);\n      });\n\n      if (this._attachments.size === 0) {\n        if (this._documentVisibilityTurnOffCleanup) {\n          this._documentVisibilityTurnOffCleanup();\n          this._documentVisibilityTurnOffCleanup = null;\n        }\n      }\n\n      maybeUpdateRenderHints(this);\n      return result;\n    }\n\n    /**\n     * Add a {@link VideoProcessor} to allow for custom processing of video frames belonging to a VideoTrack.\n     * When a Participant un-publishes and re-publishes a VideoTrack, a new RemoteVideoTrack is created and\n     * any VideoProcessors attached to the previous RemoteVideoTrack would have to be re-added again.\n     * Only Chrome supports this as of now. Calling this API from a non-supported browser will result in a log warning.\n     * @param {VideoProcessor} processor - The {@link VideoProcessor} to use.\n     * @returns {this}\n     * @example\n     * class GrayScaleProcessor {\n     *   constructor(percentage) {\n     *     this.percentage = percentage;\n     *   }\n     *   processFrame(inputFrameBuffer, outputFrameBuffer) {\n     *     const context = outputFrameBuffer.getContext('2d');\n     *     context.filter = `grayscale(${this.percentage}%)`;\n     *     context.drawImage(inputFrameBuffer, 0, 0, inputFrameBuffer.width, inputFrameBuffer.height);\n     *   }\n     * }\n     *\n     * const grayscaleProcessor = new GrayScaleProcessor(100);\n     *\n     * Array.from(room.participants.values()).forEach(participant => {\n     *   const remoteVideoTrack = Array.from(participant.videoTracks.values())[0].track;\n     *   remoteVideoTrack.addProcessor(grayscaleProcessor);\n     * });\n     */\n\n  }, {\n    key: 'addProcessor',\n    value: function addProcessor() {\n      return _get(RemoteVideoTrack.prototype.__proto__ || Object.getPrototypeOf(RemoteVideoTrack.prototype), 'addProcessor', this).apply(this, arguments);\n    }\n\n    /**\n     * Remove the previously added {@link VideoProcessor} using `addProcessor` API.\n     * @param {VideoProcessor} processor - The {@link VideoProcessor} to remove.\n     * @returns {this}\n     * @example\n     * class GrayScaleProcessor {\n     *   constructor(percentage) {\n     *     this.percentage = percentage;\n     *   }\n     *   processFrame(inputFrameBuffer, outputFrameBuffer) {\n     *     const context = outputFrameBuffer.getContext('2d');\n     *     context.filter = `grayscale(${this.percentage}%)`;\n     *     context.drawImage(inputFrameBuffer, 0, 0, inputFrameBuffer.width, inputFrameBuffer.height);\n     *   }\n     * }\n     *\n     * const grayscaleProcessor = new GrayScaleProcessor(100);\n     *\n     * Array.from(room.participants.values()).forEach(participant => {\n     *   const remoteVideoTrack = Array.from(participant.videoTracks.values())[0].track;\n     *   remoteVideoTrack.addProcessor(grayscaleProcessor);\n     * });\n     *\n     * document.getElementById('remove-button').onclick = () => {\n     *   Array.from(room.participants.values()).forEach(participant => {\n     *     const remoteVideoTrack = Array.from(participant.videoTracks.values())[0].track;\n     *     remoteVideoTrack.removeProcessor(grayscaleProcessor);\n     *   });\n     * }\n     */\n\n  }, {\n    key: 'removeProcessor',\n    value: function removeProcessor() {\n      return _get(RemoteVideoTrack.prototype.__proto__ || Object.getPrototypeOf(RemoteVideoTrack.prototype), 'removeProcessor', this).apply(this, arguments);\n    }\n  }, {\n    key: 'toString',\n    value: function toString() {\n      return '[RemoteVideoTrack #' + this._instanceId + ': ' + this.sid + ']';\n    }\n\n    /**\n     * Update the subscribe {@link Track.Priority} of the {@link RemoteVideoTrack}.\n     * @param {?Track.Priority} priority - the new subscribe {@link Track.Priority};\n     *   If <code>null</code>, then the subscribe {@link Track.Priority} is cleared, which\n     *   means the {@link Track.Priority} set by the publisher is now the effective priority.\n     * @returns {this}\n     * @throws {RangeError}\n     */\n\n  }, {\n    key: 'setPriority',\n    value: function setPriority(priority) {\n      return _get(RemoteVideoTrack.prototype.__proto__ || Object.getPrototypeOf(RemoteVideoTrack.prototype), 'setPriority', this).call(this, priority);\n    }\n  }]);\n\n  return RemoteVideoTrack;\n}(RemoteMediaVideoTrack);\n\nfunction setupDocumentVisibilityTurnOff(removeVideoTrack) {\n  function onVisibilityChanged() {\n    maybeUpdateRenderHints(removeVideoTrack);\n  }\n\n  documentVisibilityMonitor.onVisibilityChange(1, onVisibilityChanged);\n  return function () {\n    documentVisibilityMonitor.offVisibilityChange(1, onVisibilityChanged);\n  };\n}\n\nfunction maybeUpdateRenderHints(removeVideoTrack) {\n  // maybeUpdateRenderHints is applicable only for \"auto\" modes.\n  if (removeVideoTrack._clientTrackSwitchOffControl !== 'auto' && removeVideoTrack._contentPreferencesMode !== 'auto') {\n    return;\n  }\n\n  var elements = removeVideoTrack._getAllAttachedElements();\n  var updatedRenderHint = {};\n  if (removeVideoTrack._clientTrackSwitchOffControl === 'auto') {\n    // consider only visible elements.\n    elements = elements.filter(function (el) {\n      return !removeVideoTrack._invisibleElements.has(el);\n    });\n    updatedRenderHint.enabled = document.visibilityState === 'visible' && elements.length > 0;\n  }\n\n  if (removeVideoTrack._contentPreferencesMode === 'auto' && elements.length > 0) {\n    var _elements$sort = elements.sort(function (el1, el2) {\n      return el2.clientHeight + el2.clientWidth - el1.clientHeight - el1.clientWidth - 1;\n    }),\n        _elements$sort2 = _slicedToArray(_elements$sort, 1),\n        _elements$sort2$ = _elements$sort2[0],\n        clientHeight = _elements$sort2$.clientHeight,\n        clientWidth = _elements$sort2$.clientWidth;\n\n    updatedRenderHint.renderDimensions = { height: clientHeight, width: clientWidth };\n  }\n\n  removeVideoTrack._log.debug('updating render hint:', updatedRenderHint);\n  removeVideoTrack._setRenderHint(updatedRenderHint);\n}\n/**\n * @typedef {object} VideoContentPreferences\n * @property {VideoTrack.Dimensions} [renderDimensions] - Render Dimensions to request for the {@link RemoteVideoTrack}.\n */\n\n/**\n * The {@link RemoteVideoTrack}'s dimensions changed.\n * @param {RemoteVideoTrack} track - The {@link RemoteVideoTrack} whose\n *   dimensions changed\n * @event RemoteVideoTrack#dimensionsChanged\n */\n\n/**\n * The {@link RemoteVideoTrack} was disabled, i.e. \"paused\".\n * @param {RemoteVideoTrack} track - The {@link RemoteVideoTrack} that was\n *   disabled\n * @event RemoteVideoTrack#disabled\n */\n\n/**\n * The {@link RemoteVideoTrack} was enabled, i.e. \"resumed\".\n * @param {RemoteVideoTrack} track - The {@link RemoteVideoTrack} that was\n *   enabled\n * @event RemoteVideoTrack#enabled\n */\n\n/**\n * The {@link RemoteVideoTrack} started. This means there is enough video data\n * to begin playback.\n * @param {RemoteVideoTrack} track - The {@link RemoteVideoTrack} that started\n * @event RemoteVideoTrack#started\n */\n\n/**\n * A {@link RemoteVideoTrack} was switched off.\n * @param {RemoteVideoTrack} track - The {@link RemoteVideoTrack} that was\n *   switched off\n * @event RemoteVideoTrack#switchedOff\n */\n\n/**\n * A {@link RemoteVideoTrack} was switched on.\n * @param {RemoteVideoTrack} track - The {@link RemoteVideoTrack} that was\n *   switched on\n * @event RemoteVideoTrack#switchedOn\n */\n\nmodule.exports = RemoteVideoTrack;"]},"metadata":{},"sourceType":"script"}