{"ast":null,"code":"\"use strict\";\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require(\"babel-runtime/helpers/asyncToGenerator\");\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _promise = require(\"babel-runtime/core-js/promise\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _getIterator2 = require(\"babel-runtime/core-js/get-iterator\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _slicedToArray2 = require(\"babel-runtime/helpers/slicedToArray\");\n\nvar _slicedToArray3 = _interopRequireDefault(_slicedToArray2);\n\nvar _map = require(\"babel-runtime/core-js/map\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require(\"babel-runtime/helpers/createClass\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Network = void 0;\n\nvar operation_retrier_1 = require(\"operation-retrier\");\n\nvar Network = function () {\n  function Network(configuration, services) {\n    (0, _classCallCheck3.default)(this, Network);\n    this.configuration = configuration;\n    this.services = services;\n    this.cache = new _map2.default();\n    this.cacheLifetime = this.configuration.httpCacheInterval * 100;\n    this.cleanupCache();\n  }\n\n  (0, _createClass3.default)(Network, [{\n    key: \"isExpired\",\n    value: function isExpired(timestamp) {\n      return !this.cacheLifetime || Date.now() - timestamp > this.cacheLifetime;\n    }\n  }, {\n    key: \"cleanupCache\",\n    value: function cleanupCache() {\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = (0, _getIterator3.default)(this.cache), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var _ref = _step.value;\n\n          var _ref2 = (0, _slicedToArray3.default)(_ref, 2);\n\n          var k = _ref2[0];\n          var v = _ref2[1];\n\n          if (this.isExpired(v.timestamp)) {\n            this.cache.delete(k);\n          }\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      if (this.cache.size === 0) {\n        clearInterval(this.timer);\n      }\n    }\n  }, {\n    key: \"pokeTimer\",\n    value: function pokeTimer() {\n      var _this = this;\n\n      this.timer = this.timer || setInterval(function () {\n        return _this.cleanupCache();\n      }, this.cacheLifetime * 2);\n    }\n  }, {\n    key: \"executeWithRetry\",\n    value: function executeWithRetry(request) {\n      var _this2 = this;\n\n      var retryWhenThrottled = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      return new _promise2.default(function (resolve, reject) {\n        var codesToRetryOn = [502, 503, 504];\n\n        if (retryWhenThrottled) {\n          codesToRetryOn.push(429);\n        }\n\n        var retrier = new operation_retrier_1.Retrier(_this2.configuration.backoffConfiguration);\n        retrier.on('attempt', function () {\n          request().then(function (result) {\n            return retrier.succeeded(result);\n          }).catch(function (err) {\n            if (codesToRetryOn.indexOf(err.status) > -1) {\n              retrier.failed(err);\n            } else if (err.message === 'Twilsock disconnected') {\n              // Ugly hack. We must make a proper exceptions for twilsock\n              retrier.failed(err);\n            } else {\n              // Fatal error\n              retrier.removeAllListeners();\n              retrier.cancel();\n              reject(err);\n            }\n          });\n        });\n        retrier.on('succeeded', function (result) {\n          resolve(result);\n        });\n        retrier.on('cancelled', function (err) {\n          return reject(err);\n        });\n        retrier.on('failed', function (err) {\n          return reject(err);\n        });\n        retrier.start();\n      });\n    }\n  }, {\n    key: \"get\",\n    value: function () {\n      var _ref3 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee(url) {\n        var _this3 = this;\n\n        var cacheEntry, headers, response;\n        return _regenerator2.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                cacheEntry = this.cache.get(url);\n\n                if (!(cacheEntry && !this.isExpired(cacheEntry.timestamp))) {\n                  _context.next = 3;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", cacheEntry.response);\n\n              case 3:\n                headers = {};\n                _context.next = 6;\n                return this.executeWithRetry(function () {\n                  return _this3.services.transport.get(url, headers, _this3.configuration.productId);\n                }, this.configuration.retryWhenThrottled);\n\n              case 6:\n                response = _context.sent;\n                this.cache.set(url, {\n                  response: response,\n                  timestamp: Date.now()\n                });\n                this.pokeTimer();\n                return _context.abrupt(\"return\", response);\n\n              case 10:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function get(_x2) {\n        return _ref3.apply(this, arguments);\n      }\n\n      return get;\n    }()\n  }]);\n  return Network;\n}();\n\nexports.Network = Network;","map":{"version":3,"sources":["/Users/shouryagupta/Desktop/MS Engage 21/MSEngage21_VC/node_modules/twilio-chat/browser/services/network.js"],"names":["_regenerator","require","_regenerator2","_interopRequireDefault","_asyncToGenerator2","_asyncToGenerator3","_promise","_promise2","_getIterator2","_getIterator3","_slicedToArray2","_slicedToArray3","_map","_map2","_classCallCheck2","_classCallCheck3","_createClass2","_createClass3","obj","__esModule","default","Object","defineProperty","exports","value","Network","operation_retrier_1","configuration","services","cache","cacheLifetime","httpCacheInterval","cleanupCache","key","isExpired","timestamp","Date","now","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_iterator","_step","next","done","_ref","_ref2","k","v","delete","err","return","size","clearInterval","timer","pokeTimer","_this","setInterval","executeWithRetry","request","_this2","retryWhenThrottled","arguments","length","resolve","reject","codesToRetryOn","push","retrier","Retrier","backoffConfiguration","on","then","result","succeeded","catch","indexOf","status","failed","message","removeAllListeners","cancel","start","_ref3","mark","_callee","url","_this3","cacheEntry","headers","response","wrap","_callee$","_context","prev","get","abrupt","transport","productId","sent","set","stop","_x2","apply"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require(\"babel-runtime/helpers/asyncToGenerator\");\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _promise = require(\"babel-runtime/core-js/promise\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _getIterator2 = require(\"babel-runtime/core-js/get-iterator\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _slicedToArray2 = require(\"babel-runtime/helpers/slicedToArray\");\n\nvar _slicedToArray3 = _interopRequireDefault(_slicedToArray2);\n\nvar _map = require(\"babel-runtime/core-js/map\");\n\nvar _map2 = _interopRequireDefault(_map);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require(\"babel-runtime/helpers/createClass\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Network = void 0;\nvar operation_retrier_1 = require(\"operation-retrier\");\n\nvar Network = function () {\n    function Network(configuration, services) {\n        (0, _classCallCheck3.default)(this, Network);\n\n        this.configuration = configuration;\n        this.services = services;\n        this.cache = new _map2.default();\n        this.cacheLifetime = this.configuration.httpCacheInterval * 100;\n        this.cleanupCache();\n    }\n\n    (0, _createClass3.default)(Network, [{\n        key: \"isExpired\",\n        value: function isExpired(timestamp) {\n            return !this.cacheLifetime || Date.now() - timestamp > this.cacheLifetime;\n        }\n    }, {\n        key: \"cleanupCache\",\n        value: function cleanupCache() {\n            var _iteratorNormalCompletion = true;\n            var _didIteratorError = false;\n            var _iteratorError = undefined;\n\n            try {\n                for (var _iterator = (0, _getIterator3.default)(this.cache), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n                    var _ref = _step.value;\n\n                    var _ref2 = (0, _slicedToArray3.default)(_ref, 2);\n\n                    var k = _ref2[0];\n                    var v = _ref2[1];\n\n                    if (this.isExpired(v.timestamp)) {\n                        this.cache.delete(k);\n                    }\n                }\n            } catch (err) {\n                _didIteratorError = true;\n                _iteratorError = err;\n            } finally {\n                try {\n                    if (!_iteratorNormalCompletion && _iterator.return) {\n                        _iterator.return();\n                    }\n                } finally {\n                    if (_didIteratorError) {\n                        throw _iteratorError;\n                    }\n                }\n            }\n\n            if (this.cache.size === 0) {\n                clearInterval(this.timer);\n            }\n        }\n    }, {\n        key: \"pokeTimer\",\n        value: function pokeTimer() {\n            var _this = this;\n\n            this.timer = this.timer || setInterval(function () {\n                return _this.cleanupCache();\n            }, this.cacheLifetime * 2);\n        }\n    }, {\n        key: \"executeWithRetry\",\n        value: function executeWithRetry(request) {\n            var _this2 = this;\n\n            var retryWhenThrottled = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n            return new _promise2.default(function (resolve, reject) {\n                var codesToRetryOn = [502, 503, 504];\n                if (retryWhenThrottled) {\n                    codesToRetryOn.push(429);\n                }\n                var retrier = new operation_retrier_1.Retrier(_this2.configuration.backoffConfiguration);\n                retrier.on('attempt', function () {\n                    request().then(function (result) {\n                        return retrier.succeeded(result);\n                    }).catch(function (err) {\n                        if (codesToRetryOn.indexOf(err.status) > -1) {\n                            retrier.failed(err);\n                        } else if (err.message === 'Twilsock disconnected') {\n                            // Ugly hack. We must make a proper exceptions for twilsock\n                            retrier.failed(err);\n                        } else {\n                            // Fatal error\n                            retrier.removeAllListeners();\n                            retrier.cancel();\n                            reject(err);\n                        }\n                    });\n                });\n                retrier.on('succeeded', function (result) {\n                    resolve(result);\n                });\n                retrier.on('cancelled', function (err) {\n                    return reject(err);\n                });\n                retrier.on('failed', function (err) {\n                    return reject(err);\n                });\n                retrier.start();\n            });\n        }\n    }, {\n        key: \"get\",\n        value: function () {\n            var _ref3 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee(url) {\n                var _this3 = this;\n\n                var cacheEntry, headers, response;\n                return _regenerator2.default.wrap(function _callee$(_context) {\n                    while (1) {\n                        switch (_context.prev = _context.next) {\n                            case 0:\n                                cacheEntry = this.cache.get(url);\n\n                                if (!(cacheEntry && !this.isExpired(cacheEntry.timestamp))) {\n                                    _context.next = 3;\n                                    break;\n                                }\n\n                                return _context.abrupt(\"return\", cacheEntry.response);\n\n                            case 3:\n                                headers = {};\n                                _context.next = 6;\n                                return this.executeWithRetry(function () {\n                                    return _this3.services.transport.get(url, headers, _this3.configuration.productId);\n                                }, this.configuration.retryWhenThrottled);\n\n                            case 6:\n                                response = _context.sent;\n\n                                this.cache.set(url, { response: response, timestamp: Date.now() });\n                                this.pokeTimer();\n                                return _context.abrupt(\"return\", response);\n\n                            case 10:\n                            case \"end\":\n                                return _context.stop();\n                        }\n                    }\n                }, _callee, this);\n            }));\n\n            function get(_x2) {\n                return _ref3.apply(this, arguments);\n            }\n\n            return get;\n        }()\n    }]);\n    return Network;\n}();\n\nexports.Network = Network;"]},"metadata":{},"sourceType":"script"}