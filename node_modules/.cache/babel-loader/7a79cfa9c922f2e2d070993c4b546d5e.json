{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _toConsumableArray from \"/Users/shouryagupta/Desktop/MS Engage 21/MSEngage21_VC/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"/Users/shouryagupta/Desktop/MS Engage 21/MSEngage21_VC/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/shouryagupta/Desktop/MS Engage 21/MSEngage21_VC/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/shouryagupta/Desktop/MS Engage 21/MSEngage21_VC/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/shouryagupta/Desktop/MS Engage 21/MSEngage21_VC/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/shouryagupta/Desktop/MS Engage 21/MSEngage21_VC/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/Users/shouryagupta/Desktop/MS Engage 21/MSEngage21_VC/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nvar _jsxFileName = \"/Users/shouryagupta/Desktop/MS Engage 21/MSEngage21_VC/src/Chat.js\";\nimport React from \"react\";\nimport { AppBar, Backdrop, CircularProgress, Container, CssBaseline, Grid, IconButton, List, TextField, Toolbar, Typography } from \"@material-ui/core\";\nimport { Send } from \"@material-ui/icons\";\nimport ChatItem from \"./ChatItem\";\n\nvar Chat = require(\"twilio-chat\");\n\nvar ChatScreen = /*#__PURE__*/function (_React$Component) {\n  _inherits(ChatScreen, _React$Component);\n\n  var _super = _createSuper(ChatScreen);\n\n  function ChatScreen(props) {\n    var _this;\n\n    _classCallCheck(this, ChatScreen);\n\n    _this = _super.call(this, props);\n\n    _this.getToken = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(email) {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return fetch(\"/chat/token\", {\n                  method: \"POST\",\n                  body: JSON.stringify({\n                    identity: email\n                  }),\n                  headers: {\n                    \"Content-Type\": \"application/json\"\n                  }\n                }).then(function (res) {\n                  return res.json();\n                }).then(function (data) {\n                  console.log(data.token);\n                });\n\n              case 2:\n                data = _context.sent;\n                return _context.abrupt(\"return\", data.token);\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    _this.componentDidMount = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n      var email, room, token, client, channel, _channel;\n\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              // const { location } = this.props;\n              // const { state } = location || {};\n              // const { email, room } = state || {};\n              email = 'guptasam00@gmail.com';\n              room = \"un\";\n              token = \"\";\n              console.log(\"KO\"); // if (!email || !room) {\n              //   this.props.history.replace(\"/\");\n              // }\n\n              _this.setState({\n                loading: true\n              });\n\n              _context5.prev = 5;\n              _context5.next = 8;\n              return _this.getToken(email);\n\n            case 8:\n              token = _context5.sent;\n              _context5.next = 14;\n              break;\n\n            case 11:\n              _context5.prev = 11;\n              _context5.t0 = _context5[\"catch\"](5);\n              throw new Error(\"unable to get token, please reload thissss page\");\n\n            case 14:\n              _context5.next = 16;\n              return Chat.Client.create(token);\n\n            case 16:\n              client = _context5.sent;\n              client.on(\"tokenAboutToExpire\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n                var token;\n                return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                  while (1) {\n                    switch (_context2.prev = _context2.next) {\n                      case 0:\n                        _context2.next = 2;\n                        return _this.getToken(email);\n\n                      case 2:\n                        token = _context2.sent;\n                        client.updateToken(token);\n\n                      case 4:\n                      case \"end\":\n                        return _context2.stop();\n                    }\n                  }\n                }, _callee2);\n              })));\n              client.on(\"tokenExpired\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n                var token;\n                return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n                  while (1) {\n                    switch (_context3.prev = _context3.next) {\n                      case 0:\n                        _context3.next = 2;\n                        return _this.getToken(email);\n\n                      case 2:\n                        token = _context3.sent;\n                        client.updateToken(token);\n\n                      case 4:\n                      case \"end\":\n                        return _context3.stop();\n                    }\n                  }\n                }, _callee3);\n              })));\n              client.on(\"channelJoined\", /*#__PURE__*/function () {\n                var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(channel) {\n                  var messages;\n                  return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n                    while (1) {\n                      switch (_context4.prev = _context4.next) {\n                        case 0:\n                          _context4.next = 2;\n                          return channel.getMessages();\n\n                        case 2:\n                          messages = _context4.sent;\n\n                          _this.setState({\n                            messages: messages.items || []\n                          });\n\n                          _this.scrollToBottom();\n\n                        case 5:\n                        case \"end\":\n                          return _context4.stop();\n                      }\n                    }\n                  }, _callee4);\n                }));\n\n                return function (_x2) {\n                  return _ref5.apply(this, arguments);\n                };\n              }());\n              _context5.prev = 20;\n              _context5.next = 23;\n              return client.getChannelByUniqueName(room);\n\n            case 23:\n              channel = _context5.sent;\n              _context5.next = 26;\n              return _this.joinChannel(channel);\n\n            case 26:\n              _this.setState({\n                channel: channel,\n                loading: false\n              });\n\n              _context5.next = 43;\n              break;\n\n            case 29:\n              _context5.prev = 29;\n              _context5.t1 = _context5[\"catch\"](20);\n              _context5.prev = 31;\n              _context5.next = 34;\n              return client.createChannel({\n                uniqueName: room,\n                friendlyName: room\n              });\n\n            case 34:\n              _channel = _context5.sent;\n              _context5.next = 37;\n              return _this.joinChannel(_channel);\n\n            case 37:\n              _this.setState({\n                channel: _channel,\n                loading: false\n              });\n\n              _context5.next = 43;\n              break;\n\n            case 40:\n              _context5.prev = 40;\n              _context5.t2 = _context5[\"catch\"](31);\n              throw new Error(\"unable to create channel, please reload this page\");\n\n            case 43:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5, null, [[5, 11], [20, 29], [31, 40]]);\n    }));\n\n    _this.joinChannel = /*#__PURE__*/function () {\n      var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(channel) {\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                if (!(channel.channelState.status !== \"joined\")) {\n                  _context6.next = 3;\n                  break;\n                }\n\n                _context6.next = 3;\n                return channel.join();\n\n              case 3:\n                channel.on(\"messageAdded\", _this.handleMessageAdded);\n\n              case 4:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6);\n      }));\n\n      return function (_x3) {\n        return _ref6.apply(this, arguments);\n      };\n    }();\n\n    _this.handleMessageAdded = function (message) {\n      var messages = _this.state.messages;\n\n      _this.setState({\n        messages: !!messages ? [].concat(_toConsumableArray(messages), [message]) : [message]\n      }, _this.scrollToBottom);\n    };\n\n    _this.scrollToBottom = function () {\n      var scrollHeight = _this.scrollDiv.current.scrollHeight;\n      var height = _this.scrollDiv.current.clientHeight;\n      var maxScrollTop = scrollHeight - height;\n      _this.scrollDiv.current.scrollTop = maxScrollTop > 0 ? maxScrollTop : 0;\n    };\n\n    _this.sendMessage = function () {\n      var _this$state = _this.state,\n          text = _this$state.text,\n          channel = _this$state.channel;\n\n      if (text && String(text).trim()) {\n        _this.setState({\n          loading: true\n        });\n\n        channel && channel.sendMessage(text);\n\n        _this.setState({\n          text: \"\",\n          loading: false\n        });\n      }\n    };\n\n    _this.state = {\n      text: \"\",\n      messages: [],\n      loading: false,\n      channel: null\n    };\n    _this.scrollDiv = /*#__PURE__*/React.createRef();\n    return _this;\n  }\n\n  _createClass(ChatScreen, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$state2 = this.state,\n          loading = _this$state2.loading,\n          text = _this$state2.text,\n          messages = _this$state2.messages,\n          channel = _this$state2.channel;\n      var location = this.props.location;\n\n      var _ref7 = location || {},\n          state = _ref7.state;\n\n      var _ref8 = state || {},\n          email = _ref8.email,\n          room = _ref8.room;\n\n      return /*#__PURE__*/_jsxDEV(Container, {\n        component: \"main\",\n        maxWidth: \"md\",\n        children: [/*#__PURE__*/_jsxDEV(Backdrop, {\n          open: loading,\n          style: {\n            zIndex: 99999\n          },\n          children: /*#__PURE__*/_jsxDEV(CircularProgress, {\n            style: {\n              color: \"white\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 144,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(AppBar, {\n          elevation: 10,\n          children: /*#__PURE__*/_jsxDEV(Toolbar, {\n            children: /*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"h6\",\n              children: \"Room: \".concat(room, \", User: \").concat(email)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 148,\n              columnNumber: 13\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 147,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(CssBaseline, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          container: true,\n          direction: \"column\",\n          style: styles.mainGrid,\n          children: [/*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            style: styles.gridItemChatList,\n            ref: this.scrollDiv,\n            children: /*#__PURE__*/_jsxDEV(List, {\n              dense: true,\n              children: messages && messages.map(function (message) {\n                return /*#__PURE__*/_jsxDEV(ChatItem, {\n                  message: message,\n                  email: email\n                }, message.index, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 159,\n                  columnNumber: 19\n                }, _this2);\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 156,\n              columnNumber: 13\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 155,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            style: styles.gridItemMessage,\n            children: /*#__PURE__*/_jsxDEV(Grid, {\n              container: true,\n              direction: \"row\",\n              justify: \"center\",\n              alignItems: \"center\",\n              children: [/*#__PURE__*/_jsxDEV(Grid, {\n                item: true,\n                style: styles.textFieldContainer,\n                children: /*#__PURE__*/_jsxDEV(TextField, {\n                  required: true,\n                  style: styles.textField,\n                  placeholder: \"Enter message\",\n                  variant: \"outlined\",\n                  multiline: true,\n                  rows: 2,\n                  value: text,\n                  disabled: !channel,\n                  onChange: function onChange(event) {\n                    return _this2.setState({\n                      text: event.target.value\n                    });\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 175,\n                  columnNumber: 17\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 174,\n                columnNumber: 15\n              }, this), /*#__PURE__*/_jsxDEV(Grid, {\n                item: true,\n                children: /*#__PURE__*/_jsxDEV(IconButton, {\n                  style: styles.sendButton,\n                  onClick: this.sendMessage,\n                  disabled: !channel || !text,\n                  children: /*#__PURE__*/_jsxDEV(Send, {\n                    style: styles.sendIcon\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 195,\n                    columnNumber: 19\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 190,\n                  columnNumber: 17\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 189,\n                columnNumber: 15\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 168,\n              columnNumber: 13\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 167,\n            columnNumber: 11\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 7\n      }, this);\n    }\n  }]);\n\n  return ChatScreen;\n}(React.Component);\n\nvar styles = {\n  textField: {\n    width: \"100%\",\n    borderWidth: 0,\n    borderColor: \"transparent\"\n  },\n  textFieldContainer: {\n    flex: 1,\n    marginRight: 12\n  },\n  gridItem: {\n    paddingTop: 12,\n    paddingBottom: 12\n  },\n  gridItemChatList: {\n    overflow: \"auto\",\n    height: \"70vh\"\n  },\n  gridItemMessage: {\n    marginTop: 12,\n    marginBottom: 12\n  },\n  sendButton: {\n    backgroundColor: \"#3f51b5\"\n  },\n  sendIcon: {\n    color: \"white\"\n  },\n  mainGrid: {\n    paddingTop: 100,\n    borderWidth: 1\n  }\n};\nexport default ChatScreen;","map":{"version":3,"sources":["/Users/shouryagupta/Desktop/MS Engage 21/MSEngage21_VC/src/Chat.js"],"names":["React","AppBar","Backdrop","CircularProgress","Container","CssBaseline","Grid","IconButton","List","TextField","Toolbar","Typography","Send","ChatItem","Chat","require","ChatScreen","props","getToken","email","fetch","method","body","JSON","stringify","identity","headers","then","res","json","data","console","log","token","componentDidMount","room","setState","loading","Error","Client","create","client","on","updateToken","channel","getMessages","messages","items","scrollToBottom","getChannelByUniqueName","joinChannel","createChannel","uniqueName","friendlyName","channelState","status","join","handleMessageAdded","message","state","scrollHeight","scrollDiv","current","height","clientHeight","maxScrollTop","scrollTop","sendMessage","text","String","trim","createRef","location","zIndex","color","styles","mainGrid","gridItemChatList","map","index","gridItemMessage","textFieldContainer","textField","event","target","value","sendButton","sendIcon","Component","width","borderWidth","borderColor","flex","marginRight","gridItem","paddingTop","paddingBottom","overflow","marginTop","marginBottom","backgroundColor"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport {\n  AppBar,\n  Backdrop,\n  CircularProgress,\n  Container,\n  CssBaseline,\n  Grid,\n  IconButton,\n  List,\n  TextField,\n  Toolbar,\n  Typography,\n} from \"@material-ui/core\";\nimport { Send } from \"@material-ui/icons\";\nimport ChatItem from \"./ChatItem\";\nconst Chat = require(\"twilio-chat\");\n\nclass ChatScreen extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      text: \"\",\n      messages: [],\n      loading: false,\n      channel: null,\n    };\n\n    this.scrollDiv = React.createRef();\n  };\n  getToken = async (email) => {\n    data = await fetch(\"/chat/token\", {\n      method: \"POST\",\n      body: JSON.stringify({\n        identity: email,\n      }),\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n    }).then((res) => res.json()).then((data)=>{console.log(data.token)});\n    return data.token;\n  };\n\n  componentDidMount = async () => {\n    // const { location } = this.props;\n    // const { state } = location || {};\n    // const { email, room } = state || {};\n    const email = 'guptasam00@gmail.com';\n    const room = \"un\";\n    let token = \"\";\n    console.log(\"KO\");\n    // if (!email || !room) {\n    //   this.props.history.replace(\"/\");\n    // }\n\n    this.setState({ loading: true });\n\n    try {\n      token = await this.getToken(email);\n    } catch {\n      throw new Error(\"unable to get token, please reload thissss page\");\n    }\n\n    const client = await Chat.Client.create(token);\n\n    client.on(\"tokenAboutToExpire\", async () => {\n      const token = await this.getToken(email);\n      client.updateToken(token);\n    });\n\n    client.on(\"tokenExpired\", async () => {\n      const token = await this.getToken(email);\n      client.updateToken(token);\n    });\n\n    client.on(\"channelJoined\", async (channel) => {\n      // getting list of all messages since this is an existing channel\n      const messages = await channel.getMessages();\n      this.setState({ messages: messages.items || [] });\n      this.scrollToBottom();\n    });\n\n    try {\n      const channel = await client.getChannelByUniqueName(room);\n      await this.joinChannel(channel);\n      this.setState({ channel, loading: false });\n    } catch {\n      try {\n        const channel = await client.createChannel({\n          uniqueName: room,\n          friendlyName: room,\n        });\n        await this.joinChannel(channel);\n        this.setState({ channel, loading: false });\n      } catch {\n        throw new Error(\"unable to create channel, please reload this page\");\n      }\n    }\n  };\n\n  joinChannel = async (channel) => {\n    if (channel.channelState.status !== \"joined\") {\n      await channel.join();\n    }\n    channel.on(\"messageAdded\", this.handleMessageAdded);\n  };\n\n  handleMessageAdded = (message) => {\n    const { messages } = this.state;\n    this.setState(\n      {\n        messages: !!messages ? [...messages, message] : [message],\n      },\n      this.scrollToBottom\n    );\n  };\n\n  scrollToBottom = () => {\n    const scrollHeight = this.scrollDiv.current.scrollHeight;\n    const height = this.scrollDiv.current.clientHeight;\n    const maxScrollTop = scrollHeight - height;\n    this.scrollDiv.current.scrollTop = maxScrollTop > 0 ? maxScrollTop : 0;\n  };\n\n  sendMessage = () => {\n    const { text, channel } = this.state;\n    if (text && String(text).trim()) {\n      this.setState({ loading: true });\n      channel && channel.sendMessage(text);\n      this.setState({ text: \"\", loading: false });\n    }\n  };\n\n  render() {\n    const { loading, text, messages, channel } = this.state;\n    const { location } = this.props;\n    const { state } = location || {};\n    const { email, room } = state || {};\n\n    return (\n      <Container component=\"main\" maxWidth=\"md\">\n        <Backdrop open={loading} style={{ zIndex: 99999 }}>\n          <CircularProgress style={{ color: \"white\" }} />\n        </Backdrop>\n        <AppBar elevation={10}>\n          <Toolbar>\n            <Typography variant=\"h6\">\n              {`Room: ${room}, User: ${email}`}\n            </Typography>\n          </Toolbar>\n        </AppBar>\n        <CssBaseline />\n        <Grid container direction=\"column\" style={styles.mainGrid}>\n          <Grid item style={styles.gridItemChatList} ref={this.scrollDiv}>\n            <List dense={true}>\n              {messages &&\n                messages.map((message) => (\n                  <ChatItem\n                    key={message.index}\n                    message={message}\n                    email={email}\n                  />\n                ))}\n            </List>\n          </Grid>\n          <Grid item style={styles.gridItemMessage}>\n            <Grid\n              container\n              direction=\"row\"\n              justify=\"center\"\n              alignItems=\"center\"\n            >\n              <Grid item style={styles.textFieldContainer}>\n                <TextField\n                  required\n                  style={styles.textField}\n                  placeholder=\"Enter message\"\n                  variant=\"outlined\"\n                  multiline\n                  rows={2}\n                  value={text}\n                  disabled={!channel}\n                  onChange={(event) =>\n                    this.setState({ text: event.target.value })\n                  }\n                />\n              </Grid>\n              <Grid item>\n                <IconButton\n                  style={styles.sendButton}\n                  onClick={this.sendMessage}\n                  disabled={!channel || !text}\n                >\n                  <Send style={styles.sendIcon} />\n                </IconButton>\n              </Grid>\n            </Grid>\n          </Grid>\n        </Grid>\n      </Container>\n    );\n  }\n}\n\nconst styles = {\n  textField: { width: \"100%\", borderWidth: 0, borderColor: \"transparent\" },\n  textFieldContainer: { flex: 1, marginRight: 12 },\n  gridItem: { paddingTop: 12, paddingBottom: 12 },\n  gridItemChatList: { overflow: \"auto\", height: \"70vh\" },\n  gridItemMessage: { marginTop: 12, marginBottom: 12 },\n  sendButton: { backgroundColor: \"#3f51b5\" },\n  sendIcon: { color: \"white\" },\n  mainGrid: { paddingTop: 100, borderWidth: 1 },\n};\n\nexport default ChatScreen;\n"]},"metadata":{},"sourceType":"module"}