{"ast":null,"code":"\"use strict\";\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _stringify = require(\"babel-runtime/core-js/json/stringify\");\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nvar _entries = require(\"babel-runtime/core-js/object/entries\");\n\nvar _entries2 = _interopRequireDefault(_entries);\n\nvar _assign = require(\"babel-runtime/core-js/object/assign\");\n\nvar _assign2 = _interopRequireDefault(_assign);\n\nvar _asyncToGenerator2 = require(\"babel-runtime/helpers/asyncToGenerator\");\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require(\"babel-runtime/helpers/createClass\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CommandExecutor = void 0;\n\nvar uuid_1 = require(\"uuid\");\n\nvar operation_retrier_1 = require(\"operation-retrier\");\n\nvar trimSlashes = function trimSlashes(url) {\n  return url.replace(/(^\\/+|\\/+$)/g, '');\n};\n\nvar isMutationConflictResponse = function isMutationConflictResponse(response) {\n  return response.status.code === 202;\n};\n\nvar CommandExecutor = function () {\n  function CommandExecutor(_serviceUrl, _services, _productId) {\n    (0, _classCallCheck3.default)(this, CommandExecutor);\n    this._serviceUrl = _serviceUrl;\n    this._services = _services;\n    this._productId = _productId;\n  }\n\n  (0, _createClass3.default)(CommandExecutor, [{\n    key: \"_preProcessUrl\",\n    value: function _preProcessUrl(url) {\n      var trimmedUrl = trimSlashes(url);\n\n      if (/^https?:\\/\\//.test(url)) {\n        return trimmedUrl;\n      }\n\n      return trimSlashes(this._serviceUrl) + \"/\" + trimmedUrl;\n    }\n  }, {\n    key: \"_makeRequest\",\n    value: function () {\n      var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee(method, url, requestBody, headers) {\n        var preProcessedUrl, finalHeaders, response, getUrl;\n        return _regenerator2.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                preProcessedUrl = this._preProcessUrl(url);\n                finalHeaders = (0, _assign2.default)({\n                  'Content-Type': 'application/json; charset=utf-8'\n                }, headers || {});\n                response = void 0;\n                _context.t0 = method;\n                _context.next = _context.t0 === 'get' ? 6 : _context.t0 === 'post' ? 12 : _context.t0 === 'delete' ? 16 : 20;\n                break;\n\n              case 6:\n                getUrl = preProcessedUrl;\n\n                if (requestBody) {\n                  getUrl += '?' + (0, _entries2.default)(requestBody).map(function (entry) {\n                    return entry.map(encodeURIComponent).join('=');\n                  }).join('&');\n                }\n\n                _context.next = 10;\n                return this._services.transport.get(getUrl, finalHeaders, this._productId);\n\n              case 10:\n                response = _context.sent;\n                return _context.abrupt(\"break\", 20);\n\n              case 12:\n                _context.next = 14;\n                return this._services.transport.post(preProcessedUrl, finalHeaders, (0, _stringify2.default)(requestBody), this._productId);\n\n              case 14:\n                response = _context.sent;\n                return _context.abrupt(\"break\", 20);\n\n              case 16:\n                _context.next = 18;\n                return this._services.transport.delete(preProcessedUrl, finalHeaders, this._productId);\n\n              case 18:\n                response = _context.sent;\n                return _context.abrupt(\"break\", 20);\n\n              case 20:\n                if (!(response.status.code < 200 || response.status.code >= 300)) {\n                  _context.next = 22;\n                  break;\n                }\n\n                throw new Error(\"Request responded with a non-success code \" + response.status.code);\n\n              case 22:\n                return _context.abrupt(\"return\", response);\n\n              case 23:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function _makeRequest(_x, _x2, _x3, _x4) {\n        return _ref.apply(this, arguments);\n      }\n\n      return _makeRequest;\n    }()\n  }, {\n    key: \"fetchResource\",\n    value: function () {\n      var _ref2 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2(url, requestBody) {\n        var _this = this;\n\n        var maxAttemptsCount, result;\n        return _regenerator2.default.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                maxAttemptsCount = 6;\n                result = void 0;\n                _context2.prev = 2;\n                _context2.next = 5;\n                return new operation_retrier_1.Retrier({\n                  min: 50,\n                  max: 1600,\n                  maxAttemptsCount: maxAttemptsCount\n                }).run(function () {\n                  return _this._makeRequest('get', url, requestBody);\n                });\n\n              case 5:\n                result = _context2.sent;\n                _context2.next = 11;\n                break;\n\n              case 8:\n                _context2.prev = 8;\n                _context2.t0 = _context2[\"catch\"](2);\n                throw new Error(\"Fetch resource from \\\"\" + url + \"\\\" failed.\");\n\n              case 11:\n                return _context2.abrupt(\"return\", result.body);\n\n              case 12:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[2, 8]]);\n      }));\n\n      function fetchResource(_x5, _x6) {\n        return _ref2.apply(this, arguments);\n      }\n\n      return fetchResource;\n    }()\n  }, {\n    key: \"mutateResource\",\n    value: function () {\n      var _ref3 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee3(method, url, requestBody) {\n        var result;\n        return _regenerator2.default.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return this._makeRequest(method, url, requestBody, {\n                  'X-Twilio-Mutation-Id': uuid_1.v4()\n                });\n\n              case 2:\n                result = _context3.sent;\n\n                if (!isMutationConflictResponse(result)) {\n                  _context3.next = 7;\n                  break;\n                }\n\n                _context3.next = 6;\n                return this.fetchResource(result.body.resource_url);\n\n              case 6:\n                return _context3.abrupt(\"return\", _context3.sent);\n\n              case 7:\n                return _context3.abrupt(\"return\", result.body);\n\n              case 8:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function mutateResource(_x7, _x8, _x9) {\n        return _ref3.apply(this, arguments);\n      }\n\n      return mutateResource;\n    }()\n  }]);\n  return CommandExecutor;\n}();\n\nexports.CommandExecutor = CommandExecutor;","map":{"version":3,"sources":["/Users/shouryagupta/Desktop/MS Engage 21/MSEngage21_VC/node_modules/twilio-chat/browser/commandexecutor.js"],"names":["_regenerator","require","_regenerator2","_interopRequireDefault","_stringify","_stringify2","_entries","_entries2","_assign","_assign2","_asyncToGenerator2","_asyncToGenerator3","_classCallCheck2","_classCallCheck3","_createClass2","_createClass3","obj","__esModule","default","Object","defineProperty","exports","value","CommandExecutor","uuid_1","operation_retrier_1","trimSlashes","url","replace","isMutationConflictResponse","response","status","code","_serviceUrl","_services","_productId","key","_preProcessUrl","trimmedUrl","test","_ref","mark","_callee","method","requestBody","headers","preProcessedUrl","finalHeaders","getUrl","wrap","_callee$","_context","prev","next","t0","map","entry","encodeURIComponent","join","transport","get","sent","abrupt","post","delete","Error","stop","_makeRequest","_x","_x2","_x3","_x4","apply","arguments","_ref2","_callee2","_this","maxAttemptsCount","result","_callee2$","_context2","Retrier","min","max","run","body","fetchResource","_x5","_x6","_ref3","_callee3","_callee3$","_context3","v4","resource_url","mutateResource","_x7","_x8","_x9"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _stringify = require(\"babel-runtime/core-js/json/stringify\");\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nvar _entries = require(\"babel-runtime/core-js/object/entries\");\n\nvar _entries2 = _interopRequireDefault(_entries);\n\nvar _assign = require(\"babel-runtime/core-js/object/assign\");\n\nvar _assign2 = _interopRequireDefault(_assign);\n\nvar _asyncToGenerator2 = require(\"babel-runtime/helpers/asyncToGenerator\");\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require(\"babel-runtime/helpers/createClass\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.CommandExecutor = void 0;\nvar uuid_1 = require(\"uuid\");\nvar operation_retrier_1 = require(\"operation-retrier\");\nvar trimSlashes = function trimSlashes(url) {\n    return url.replace(/(^\\/+|\\/+$)/g, '');\n};\nvar isMutationConflictResponse = function isMutationConflictResponse(response) {\n    return response.status.code === 202;\n};\n\nvar CommandExecutor = function () {\n    function CommandExecutor(_serviceUrl, _services, _productId) {\n        (0, _classCallCheck3.default)(this, CommandExecutor);\n\n        this._serviceUrl = _serviceUrl;\n        this._services = _services;\n        this._productId = _productId;\n    }\n\n    (0, _createClass3.default)(CommandExecutor, [{\n        key: \"_preProcessUrl\",\n        value: function _preProcessUrl(url) {\n            var trimmedUrl = trimSlashes(url);\n            if (/^https?:\\/\\//.test(url)) {\n                return trimmedUrl;\n            }\n            return trimSlashes(this._serviceUrl) + \"/\" + trimmedUrl;\n        }\n    }, {\n        key: \"_makeRequest\",\n        value: function () {\n            var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee(method, url, requestBody, headers) {\n                var preProcessedUrl, finalHeaders, response, getUrl;\n                return _regenerator2.default.wrap(function _callee$(_context) {\n                    while (1) {\n                        switch (_context.prev = _context.next) {\n                            case 0:\n                                preProcessedUrl = this._preProcessUrl(url);\n                                finalHeaders = (0, _assign2.default)({ 'Content-Type': 'application/json; charset=utf-8' }, headers || {});\n                                response = void 0;\n                                _context.t0 = method;\n                                _context.next = _context.t0 === 'get' ? 6 : _context.t0 === 'post' ? 12 : _context.t0 === 'delete' ? 16 : 20;\n                                break;\n\n                            case 6:\n                                getUrl = preProcessedUrl;\n\n                                if (requestBody) {\n                                    getUrl += '?' + (0, _entries2.default)(requestBody).map(function (entry) {\n                                        return entry.map(encodeURIComponent).join('=');\n                                    }).join('&');\n                                }\n                                _context.next = 10;\n                                return this._services.transport.get(getUrl, finalHeaders, this._productId);\n\n                            case 10:\n                                response = _context.sent;\n                                return _context.abrupt(\"break\", 20);\n\n                            case 12:\n                                _context.next = 14;\n                                return this._services.transport.post(preProcessedUrl, finalHeaders, (0, _stringify2.default)(requestBody), this._productId);\n\n                            case 14:\n                                response = _context.sent;\n                                return _context.abrupt(\"break\", 20);\n\n                            case 16:\n                                _context.next = 18;\n                                return this._services.transport.delete(preProcessedUrl, finalHeaders, this._productId);\n\n                            case 18:\n                                response = _context.sent;\n                                return _context.abrupt(\"break\", 20);\n\n                            case 20:\n                                if (!(response.status.code < 200 || response.status.code >= 300)) {\n                                    _context.next = 22;\n                                    break;\n                                }\n\n                                throw new Error(\"Request responded with a non-success code \" + response.status.code);\n\n                            case 22:\n                                return _context.abrupt(\"return\", response);\n\n                            case 23:\n                            case \"end\":\n                                return _context.stop();\n                        }\n                    }\n                }, _callee, this);\n            }));\n\n            function _makeRequest(_x, _x2, _x3, _x4) {\n                return _ref.apply(this, arguments);\n            }\n\n            return _makeRequest;\n        }()\n    }, {\n        key: \"fetchResource\",\n        value: function () {\n            var _ref2 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2(url, requestBody) {\n                var _this = this;\n\n                var maxAttemptsCount, result;\n                return _regenerator2.default.wrap(function _callee2$(_context2) {\n                    while (1) {\n                        switch (_context2.prev = _context2.next) {\n                            case 0:\n                                maxAttemptsCount = 6;\n                                result = void 0;\n                                _context2.prev = 2;\n                                _context2.next = 5;\n                                return new operation_retrier_1.Retrier({ min: 50, max: 1600, maxAttemptsCount: maxAttemptsCount }).run(function () {\n                                    return _this._makeRequest('get', url, requestBody);\n                                });\n\n                            case 5:\n                                result = _context2.sent;\n                                _context2.next = 11;\n                                break;\n\n                            case 8:\n                                _context2.prev = 8;\n                                _context2.t0 = _context2[\"catch\"](2);\n                                throw new Error(\"Fetch resource from \\\"\" + url + \"\\\" failed.\");\n\n                            case 11:\n                                return _context2.abrupt(\"return\", result.body);\n\n                            case 12:\n                            case \"end\":\n                                return _context2.stop();\n                        }\n                    }\n                }, _callee2, this, [[2, 8]]);\n            }));\n\n            function fetchResource(_x5, _x6) {\n                return _ref2.apply(this, arguments);\n            }\n\n            return fetchResource;\n        }()\n    }, {\n        key: \"mutateResource\",\n        value: function () {\n            var _ref3 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee3(method, url, requestBody) {\n                var result;\n                return _regenerator2.default.wrap(function _callee3$(_context3) {\n                    while (1) {\n                        switch (_context3.prev = _context3.next) {\n                            case 0:\n                                _context3.next = 2;\n                                return this._makeRequest(method, url, requestBody, {\n                                    'X-Twilio-Mutation-Id': uuid_1.v4()\n                                });\n\n                            case 2:\n                                result = _context3.sent;\n\n                                if (!isMutationConflictResponse(result)) {\n                                    _context3.next = 7;\n                                    break;\n                                }\n\n                                _context3.next = 6;\n                                return this.fetchResource(result.body.resource_url);\n\n                            case 6:\n                                return _context3.abrupt(\"return\", _context3.sent);\n\n                            case 7:\n                                return _context3.abrupt(\"return\", result.body);\n\n                            case 8:\n                            case \"end\":\n                                return _context3.stop();\n                        }\n                    }\n                }, _callee3, this);\n            }));\n\n            function mutateResource(_x7, _x8, _x9) {\n                return _ref3.apply(this, arguments);\n            }\n\n            return mutateResource;\n        }()\n    }]);\n    return CommandExecutor;\n}();\n\nexports.CommandExecutor = CommandExecutor;"]},"metadata":{},"sourceType":"script"}