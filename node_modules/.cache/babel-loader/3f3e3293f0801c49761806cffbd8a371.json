{"ast":null,"code":"\"use strict\";\n\nvar _promise = require(\"babel-runtime/core-js/promise\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require(\"babel-runtime/helpers/asyncToGenerator\");\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _getPrototypeOf = require(\"babel-runtime/core-js/object/get-prototype-of\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require(\"babel-runtime/helpers/createClass\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require(\"babel-runtime/helpers/possibleConstructorReturn\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require(\"babel-runtime/helpers/inherits\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Members = void 0;\n\nvar events_1 = require(\"events\");\n\nvar member_1 = require(\"../member\");\n\nvar logger_1 = require(\"../logger\");\n\nvar log = logger_1.Logger.scope('Members');\n/**\n * @classdesc Represents the collection of members for the channel\n * @fires Members#memberJoined\n * @fires Members#memberLeft\n * @fires Members#memberUpdated\n */\n\nvar Members = function (_events_1$EventEmitte) {\n  (0, _inherits3.default)(Members, _events_1$EventEmitte);\n\n  function Members(channel, members, links, configuration, services) {\n    (0, _classCallCheck3.default)(this, Members);\n\n    var _this = (0, _possibleConstructorReturn3.default)(this, (Members.__proto__ || (0, _getPrototypeOf2.default)(Members)).call(this));\n\n    _this.channel = channel;\n    _this.members = members;\n    _this.links = links;\n    _this.configuration = configuration;\n    _this.services = services;\n    return _this;\n  }\n\n  (0, _createClass3.default)(Members, [{\n    key: \"unsubscribe\",\n    value: function () {\n      var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {\n        var entity;\n        return _regenerator2.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!this.rosterEntityPromise) {\n                  _context.next = 6;\n                  break;\n                }\n\n                _context.next = 3;\n                return this.rosterEntityPromise;\n\n              case 3:\n                entity = _context.sent;\n                entity.close();\n                this.rosterEntityPromise = null;\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function unsubscribe() {\n        return _ref.apply(this, arguments);\n      }\n\n      return unsubscribe;\n    }()\n  }, {\n    key: \"subscribe\",\n    value: function subscribe(rosterObjectName) {\n      var _this2 = this;\n\n      return this.rosterEntityPromise = this.rosterEntityPromise || this.services.syncClient.map({\n        id: rosterObjectName,\n        mode: 'open_existing'\n      }).then(function (rosterMap) {\n        rosterMap.on('itemAdded', function (args) {\n          log.debug(_this2.channel.sid + ' itemAdded: ' + args.item.key);\n\n          _this2.upsertMember(args.item.key, args.item.data).then(function (member) {\n            _this2.emit('memberJoined', member);\n          });\n        });\n        rosterMap.on('itemRemoved', function (args) {\n          log.debug(_this2.channel.sid + ' itemRemoved: ' + args.key);\n          var memberSid = args.key;\n\n          if (!_this2.members.has(memberSid)) {\n            return;\n          }\n\n          var leftMember = _this2.members.get(memberSid);\n\n          _this2.members.delete(memberSid);\n\n          _this2.emit('memberLeft', leftMember);\n        });\n        rosterMap.on('itemUpdated', function (args) {\n          log.debug(_this2.channel.sid + ' itemUpdated: ' + args.item.key);\n\n          _this2.upsertMember(args.item.key, args.item.data);\n        });\n        var membersPromises = [];\n        var that = _this2;\n\n        var rosterMapHandler = function rosterMapHandler(paginator) {\n          paginator.items.forEach(function (item) {\n            membersPromises.push(that.upsertMember(item.key, item.data));\n          });\n          return paginator.hasNextPage ? paginator.nextPage().then(rosterMapHandler) : null;\n        };\n\n        return rosterMap.getItems().then(rosterMapHandler).then(function () {\n          return _promise2.default.all(membersPromises);\n        }).then(function () {\n          return rosterMap;\n        });\n      }).catch(function (err) {\n        _this2.rosterEntityPromise = null;\n\n        if (_this2.services.syncClient.connectionState != 'disconnected') {\n          log.error('Failed to get roster object for channel', _this2.channel.sid, err);\n        }\n\n        log.debug('ERROR: Failed to get roster object for channel', _this2.channel.sid, err);\n        throw err;\n      });\n    }\n  }, {\n    key: \"upsertMember\",\n    value: function () {\n      var _ref2 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2(memberSid, data) {\n        var _this3 = this;\n\n        var member, links;\n        return _regenerator2.default.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                member = this.members.get(memberSid);\n\n                if (!member) {\n                  _context2.next = 3;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\", member._update(data));\n\n              case 3:\n                links = {\n                  self: this.links.participants + \"/\" + memberSid\n                };\n                member = new member_1.Member(data, memberSid, this.channel, links, this.services);\n                this.members.set(memberSid, member);\n                member.on('updated', function (args) {\n                  return _this3.emit('memberUpdated', args);\n                });\n                return _context2.abrupt(\"return\", member);\n\n              case 8:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function upsertMember(_x, _x2) {\n        return _ref2.apply(this, arguments);\n      }\n\n      return upsertMember;\n    }()\n    /**\n     * @returns {Promise<Array<Member>>} returns list of members {@see Member}\n     */\n\n  }, {\n    key: \"getMembers\",\n    value: function getMembers() {\n      var _this4 = this;\n\n      return this.rosterEntityPromise.then(function () {\n        var members = [];\n\n        _this4.members.forEach(function (member) {\n          return members.push(member);\n        });\n\n        return members;\n      });\n    }\n    /**\n     * Get member by SID from channel\n     * @returns {Promise<Member>}\n     */\n\n  }, {\n    key: \"getMemberBySid\",\n    value: function () {\n      var _ref3 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee3(memberSid) {\n        var _this5 = this;\n\n        return _regenerator2.default.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                return _context3.abrupt(\"return\", this.rosterEntityPromise.then(function () {\n                  var member = _this5.members.get(memberSid);\n\n                  if (!member) {\n                    throw new Error('Member with SID ' + memberSid + ' was not found');\n                  }\n\n                  return member;\n                }));\n\n              case 1:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function getMemberBySid(_x3) {\n        return _ref3.apply(this, arguments);\n      }\n\n      return getMemberBySid;\n    }()\n    /**\n     * Get member by identity from channel\n     * @returns {Promise<Member>}\n     */\n\n  }, {\n    key: \"getMemberByIdentity\",\n    value: function () {\n      var _ref4 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee4(identity) {\n        var _this6 = this;\n\n        var foundMember;\n        return _regenerator2.default.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                foundMember = null;\n                return _context4.abrupt(\"return\", this.rosterEntityPromise.then(function () {\n                  _this6.members.forEach(function (member) {\n                    if (member.identity === identity) {\n                      foundMember = member;\n                    }\n                  });\n\n                  if (!foundMember) {\n                    throw new Error('Member with identity ' + identity + ' was not found');\n                  }\n\n                  return foundMember;\n                }));\n\n              case 2:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function getMemberByIdentity(_x4) {\n        return _ref4.apply(this, arguments);\n      }\n\n      return getMemberByIdentity;\n    }()\n    /**\n     * Add user to the channel\n     * @returns {Promise<any>}\n     */\n\n  }, {\n    key: \"add\",\n    value: function () {\n      var _ref5 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee5(identity) {\n        return _regenerator2.default.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.next = 2;\n                return this.services.commandExecutor.mutateResource('post', this.links.participants, {\n                  identity: identity\n                });\n\n              case 2:\n                return _context5.abrupt(\"return\", _context5.sent);\n\n              case 3:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function add(_x5) {\n        return _ref5.apply(this, arguments);\n      }\n\n      return add;\n    }()\n    /**\n     * Invites user to the channel\n     * User can choose either to join or not\n     * @returns {Promise<any>}\n     */\n\n  }, {\n    key: \"invite\",\n    value: function () {\n      var _ref6 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee6(identity) {\n        return _regenerator2.default.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.next = 2;\n                return this.services.commandExecutor.mutateResource('post', this.channel.links.invites, {\n                  identity: identity\n                });\n\n              case 2:\n                return _context6.abrupt(\"return\", _context6.sent);\n\n              case 3:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function invite(_x6) {\n        return _ref6.apply(this, arguments);\n      }\n\n      return invite;\n    }()\n    /**\n     * Remove member from channel\n     * @returns {Promise<any>}\n     */\n\n  }, {\n    key: \"remove\",\n    value: function () {\n      var _ref7 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee7(identity) {\n        return _regenerator2.default.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.next = 2;\n                return this.services.commandExecutor.mutateResource('delete', this.links.participants + \"/\" + identity);\n\n              case 2:\n                return _context7.abrupt(\"return\", _context7.sent);\n\n              case 3:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function remove(_x7) {\n        return _ref7.apply(this, arguments);\n      }\n\n      return remove;\n    }()\n  }]);\n  return Members;\n}(events_1.EventEmitter);\n\nexports.Members = Members;\n/**\n * Fired when member joined channel\n * @event Members#memberJoined\n * @type {Member}\n */\n\n/**\n * Fired when member left channel\n * @event Members#memberLeft\n * @type {Member}\n */\n\n/**\n * Fired when member updated\n * @event Members#memberUpdated\n * @type {Object}\n * @property {Member} member - Updated Member\n * @property {Member#UpdateReason[]} updateReasons - Array of Member's updated event reasons\n */","map":{"version":3,"sources":["/Users/shouryagupta/Desktop/MS Engage 21/MSEngage21_VC/node_modules/twilio-chat/browser/data/members.js"],"names":["_promise","require","_promise2","_interopRequireDefault","_regenerator","_regenerator2","_asyncToGenerator2","_asyncToGenerator3","_getPrototypeOf","_getPrototypeOf2","_classCallCheck2","_classCallCheck3","_createClass2","_createClass3","_possibleConstructorReturn2","_possibleConstructorReturn3","_inherits2","_inherits3","obj","__esModule","default","Object","defineProperty","exports","value","Members","events_1","member_1","logger_1","log","Logger","scope","_events_1$EventEmitte","channel","members","links","configuration","services","_this","__proto__","call","key","_ref","mark","_callee","entity","wrap","_callee$","_context","prev","next","rosterEntityPromise","sent","close","stop","unsubscribe","apply","arguments","subscribe","rosterObjectName","_this2","syncClient","map","id","mode","then","rosterMap","on","args","debug","sid","item","upsertMember","data","member","emit","memberSid","has","leftMember","get","delete","membersPromises","that","rosterMapHandler","paginator","items","forEach","push","hasNextPage","nextPage","getItems","all","catch","err","connectionState","error","_ref2","_callee2","_this3","_callee2$","_context2","abrupt","_update","self","participants","Member","set","_x","_x2","getMembers","_this4","_ref3","_callee3","_this5","_callee3$","_context3","Error","getMemberBySid","_x3","_ref4","_callee4","identity","_this6","foundMember","_callee4$","_context4","getMemberByIdentity","_x4","_ref5","_callee5","_callee5$","_context5","commandExecutor","mutateResource","add","_x5","_ref6","_callee6","_callee6$","_context6","invites","invite","_x6","_ref7","_callee7","_callee7$","_context7","remove","_x7","EventEmitter"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _promise = require(\"babel-runtime/core-js/promise\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require(\"babel-runtime/helpers/asyncToGenerator\");\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _getPrototypeOf = require(\"babel-runtime/core-js/object/get-prototype-of\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require(\"babel-runtime/helpers/createClass\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require(\"babel-runtime/helpers/possibleConstructorReturn\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require(\"babel-runtime/helpers/inherits\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Members = void 0;\nvar events_1 = require(\"events\");\nvar member_1 = require(\"../member\");\nvar logger_1 = require(\"../logger\");\nvar log = logger_1.Logger.scope('Members');\n/**\n * @classdesc Represents the collection of members for the channel\n * @fires Members#memberJoined\n * @fires Members#memberLeft\n * @fires Members#memberUpdated\n */\n\nvar Members = function (_events_1$EventEmitte) {\n    (0, _inherits3.default)(Members, _events_1$EventEmitte);\n\n    function Members(channel, members, links, configuration, services) {\n        (0, _classCallCheck3.default)(this, Members);\n\n        var _this = (0, _possibleConstructorReturn3.default)(this, (Members.__proto__ || (0, _getPrototypeOf2.default)(Members)).call(this));\n\n        _this.channel = channel;\n        _this.members = members;\n        _this.links = links;\n        _this.configuration = configuration;\n        _this.services = services;\n        return _this;\n    }\n\n    (0, _createClass3.default)(Members, [{\n        key: \"unsubscribe\",\n        value: function () {\n            var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {\n                var entity;\n                return _regenerator2.default.wrap(function _callee$(_context) {\n                    while (1) {\n                        switch (_context.prev = _context.next) {\n                            case 0:\n                                if (!this.rosterEntityPromise) {\n                                    _context.next = 6;\n                                    break;\n                                }\n\n                                _context.next = 3;\n                                return this.rosterEntityPromise;\n\n                            case 3:\n                                entity = _context.sent;\n\n                                entity.close();\n                                this.rosterEntityPromise = null;\n\n                            case 6:\n                            case \"end\":\n                                return _context.stop();\n                        }\n                    }\n                }, _callee, this);\n            }));\n\n            function unsubscribe() {\n                return _ref.apply(this, arguments);\n            }\n\n            return unsubscribe;\n        }()\n    }, {\n        key: \"subscribe\",\n        value: function subscribe(rosterObjectName) {\n            var _this2 = this;\n\n            return this.rosterEntityPromise = this.rosterEntityPromise || this.services.syncClient.map({ id: rosterObjectName, mode: 'open_existing' }).then(function (rosterMap) {\n                rosterMap.on('itemAdded', function (args) {\n                    log.debug(_this2.channel.sid + ' itemAdded: ' + args.item.key);\n                    _this2.upsertMember(args.item.key, args.item.data).then(function (member) {\n                        _this2.emit('memberJoined', member);\n                    });\n                });\n                rosterMap.on('itemRemoved', function (args) {\n                    log.debug(_this2.channel.sid + ' itemRemoved: ' + args.key);\n                    var memberSid = args.key;\n                    if (!_this2.members.has(memberSid)) {\n                        return;\n                    }\n                    var leftMember = _this2.members.get(memberSid);\n                    _this2.members.delete(memberSid);\n                    _this2.emit('memberLeft', leftMember);\n                });\n                rosterMap.on('itemUpdated', function (args) {\n                    log.debug(_this2.channel.sid + ' itemUpdated: ' + args.item.key);\n                    _this2.upsertMember(args.item.key, args.item.data);\n                });\n                var membersPromises = [];\n                var that = _this2;\n                var rosterMapHandler = function rosterMapHandler(paginator) {\n                    paginator.items.forEach(function (item) {\n                        membersPromises.push(that.upsertMember(item.key, item.data));\n                    });\n                    return paginator.hasNextPage ? paginator.nextPage().then(rosterMapHandler) : null;\n                };\n                return rosterMap.getItems().then(rosterMapHandler).then(function () {\n                    return _promise2.default.all(membersPromises);\n                }).then(function () {\n                    return rosterMap;\n                });\n            }).catch(function (err) {\n                _this2.rosterEntityPromise = null;\n                if (_this2.services.syncClient.connectionState != 'disconnected') {\n                    log.error('Failed to get roster object for channel', _this2.channel.sid, err);\n                }\n                log.debug('ERROR: Failed to get roster object for channel', _this2.channel.sid, err);\n                throw err;\n            });\n        }\n    }, {\n        key: \"upsertMember\",\n        value: function () {\n            var _ref2 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2(memberSid, data) {\n                var _this3 = this;\n\n                var member, links;\n                return _regenerator2.default.wrap(function _callee2$(_context2) {\n                    while (1) {\n                        switch (_context2.prev = _context2.next) {\n                            case 0:\n                                member = this.members.get(memberSid);\n\n                                if (!member) {\n                                    _context2.next = 3;\n                                    break;\n                                }\n\n                                return _context2.abrupt(\"return\", member._update(data));\n\n                            case 3:\n                                links = {\n                                    self: this.links.participants + \"/\" + memberSid\n                                };\n\n                                member = new member_1.Member(data, memberSid, this.channel, links, this.services);\n                                this.members.set(memberSid, member);\n                                member.on('updated', function (args) {\n                                    return _this3.emit('memberUpdated', args);\n                                });\n                                return _context2.abrupt(\"return\", member);\n\n                            case 8:\n                            case \"end\":\n                                return _context2.stop();\n                        }\n                    }\n                }, _callee2, this);\n            }));\n\n            function upsertMember(_x, _x2) {\n                return _ref2.apply(this, arguments);\n            }\n\n            return upsertMember;\n        }()\n        /**\n         * @returns {Promise<Array<Member>>} returns list of members {@see Member}\n         */\n\n    }, {\n        key: \"getMembers\",\n        value: function getMembers() {\n            var _this4 = this;\n\n            return this.rosterEntityPromise.then(function () {\n                var members = [];\n                _this4.members.forEach(function (member) {\n                    return members.push(member);\n                });\n                return members;\n            });\n        }\n        /**\n         * Get member by SID from channel\n         * @returns {Promise<Member>}\n         */\n\n    }, {\n        key: \"getMemberBySid\",\n        value: function () {\n            var _ref3 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee3(memberSid) {\n                var _this5 = this;\n\n                return _regenerator2.default.wrap(function _callee3$(_context3) {\n                    while (1) {\n                        switch (_context3.prev = _context3.next) {\n                            case 0:\n                                return _context3.abrupt(\"return\", this.rosterEntityPromise.then(function () {\n                                    var member = _this5.members.get(memberSid);\n                                    if (!member) {\n                                        throw new Error('Member with SID ' + memberSid + ' was not found');\n                                    }\n                                    return member;\n                                }));\n\n                            case 1:\n                            case \"end\":\n                                return _context3.stop();\n                        }\n                    }\n                }, _callee3, this);\n            }));\n\n            function getMemberBySid(_x3) {\n                return _ref3.apply(this, arguments);\n            }\n\n            return getMemberBySid;\n        }()\n        /**\n         * Get member by identity from channel\n         * @returns {Promise<Member>}\n         */\n\n    }, {\n        key: \"getMemberByIdentity\",\n        value: function () {\n            var _ref4 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee4(identity) {\n                var _this6 = this;\n\n                var foundMember;\n                return _regenerator2.default.wrap(function _callee4$(_context4) {\n                    while (1) {\n                        switch (_context4.prev = _context4.next) {\n                            case 0:\n                                foundMember = null;\n                                return _context4.abrupt(\"return\", this.rosterEntityPromise.then(function () {\n                                    _this6.members.forEach(function (member) {\n                                        if (member.identity === identity) {\n                                            foundMember = member;\n                                        }\n                                    });\n                                    if (!foundMember) {\n                                        throw new Error('Member with identity ' + identity + ' was not found');\n                                    }\n                                    return foundMember;\n                                }));\n\n                            case 2:\n                            case \"end\":\n                                return _context4.stop();\n                        }\n                    }\n                }, _callee4, this);\n            }));\n\n            function getMemberByIdentity(_x4) {\n                return _ref4.apply(this, arguments);\n            }\n\n            return getMemberByIdentity;\n        }()\n        /**\n         * Add user to the channel\n         * @returns {Promise<any>}\n         */\n\n    }, {\n        key: \"add\",\n        value: function () {\n            var _ref5 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee5(identity) {\n                return _regenerator2.default.wrap(function _callee5$(_context5) {\n                    while (1) {\n                        switch (_context5.prev = _context5.next) {\n                            case 0:\n                                _context5.next = 2;\n                                return this.services.commandExecutor.mutateResource('post', this.links.participants, {\n                                    identity: identity\n                                });\n\n                            case 2:\n                                return _context5.abrupt(\"return\", _context5.sent);\n\n                            case 3:\n                            case \"end\":\n                                return _context5.stop();\n                        }\n                    }\n                }, _callee5, this);\n            }));\n\n            function add(_x5) {\n                return _ref5.apply(this, arguments);\n            }\n\n            return add;\n        }()\n        /**\n         * Invites user to the channel\n         * User can choose either to join or not\n         * @returns {Promise<any>}\n         */\n\n    }, {\n        key: \"invite\",\n        value: function () {\n            var _ref6 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee6(identity) {\n                return _regenerator2.default.wrap(function _callee6$(_context6) {\n                    while (1) {\n                        switch (_context6.prev = _context6.next) {\n                            case 0:\n                                _context6.next = 2;\n                                return this.services.commandExecutor.mutateResource('post', this.channel.links.invites, {\n                                    identity: identity\n                                });\n\n                            case 2:\n                                return _context6.abrupt(\"return\", _context6.sent);\n\n                            case 3:\n                            case \"end\":\n                                return _context6.stop();\n                        }\n                    }\n                }, _callee6, this);\n            }));\n\n            function invite(_x6) {\n                return _ref6.apply(this, arguments);\n            }\n\n            return invite;\n        }()\n        /**\n         * Remove member from channel\n         * @returns {Promise<any>}\n         */\n\n    }, {\n        key: \"remove\",\n        value: function () {\n            var _ref7 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee7(identity) {\n                return _regenerator2.default.wrap(function _callee7$(_context7) {\n                    while (1) {\n                        switch (_context7.prev = _context7.next) {\n                            case 0:\n                                _context7.next = 2;\n                                return this.services.commandExecutor.mutateResource('delete', this.links.participants + \"/\" + identity);\n\n                            case 2:\n                                return _context7.abrupt(\"return\", _context7.sent);\n\n                            case 3:\n                            case \"end\":\n                                return _context7.stop();\n                        }\n                    }\n                }, _callee7, this);\n            }));\n\n            function remove(_x7) {\n                return _ref7.apply(this, arguments);\n            }\n\n            return remove;\n        }()\n    }]);\n    return Members;\n}(events_1.EventEmitter);\n\nexports.Members = Members;\n/**\n * Fired when member joined channel\n * @event Members#memberJoined\n * @type {Member}\n */\n/**\n * Fired when member left channel\n * @event Members#memberLeft\n * @type {Member}\n */\n/**\n * Fired when member updated\n * @event Members#memberUpdated\n * @type {Object}\n * @property {Member} member - Updated Member\n * @property {Member#UpdateReason[]} updateReasons - Array of Member's updated event reasons\n */"]},"metadata":{},"sourceType":"script"}